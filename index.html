<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trading Village Academy</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
     <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Babel –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ JSX –≤ –±—Ä–∞—É–∑–µ—Ä–µ -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
      
      body {
        background-color: #0b0f1a;
        font-family: 'Courier Prime', monospace; /* Pixel style font */
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #0b0f1a; }
      ::-webkit-scrollbar-thumb { background: #2a3441; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #3b4a5c; }
    </style>
  </head>
  <body>
    <div id="root"></div>
    
    <!-- –ò–∑–º–µ–Ω–µ–Ω —Ç–∏–ø —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã Babel -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useCallback } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
  Trophy, Activity, Moon, BookOpen, TrendingUp, Target, Home, User, 
  ChevronRight, CheckSquare, X, Map as MapIcon, BarChart2, Gem, 
  Pocket, Shield, Zap, Star, Calendar, MessageCircle, FileText,
  Crown, CreditCard, ShoppingBag, Lock, BrainCircuit
} from 'https://esm.sh/lucide-react@0.263.1';

// üëá –∏–º–ø–æ—Ä—Ç Gemini SDK
import { GoogleGenerativeAI } from 'https://esm.sh/@google/generative-ai';

        // --- GAME DATA & CONFIGURATION ---

        const LOCATIONS = [
  {
    id: 'sleep_house',
    name: '–°–æ–Ω –∏ –†–µ–∂–∏–º',
    tvaName: '–ë–∞–Ω—è –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è',
    description: '–û—Ç–¥—ã—Ö ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç —è—Å–Ω–æ–≥–æ —É–º–∞.',
    icon: Moon,
    color: 'text-indigo-400',
    category: 'sleep',
    defaultTasks: [
      { title: '–†–µ–∂–∏–º —Å–Ω–∞', description: '–õ–µ—á—å —Å–ø–∞—Ç—å –≤–æ–≤—Ä–µ–º—è', category: 'sleep', exp: 20, value: 1, unit: 'check' },
      { title: '–†–∞–Ω–Ω—è—è –ø—Ç–∞—à–∫–∞', description: '–í—Å—Ç–∞—Ç—å –ø–æ –±—É–¥–∏–ª—å–Ω–∏–∫—É', category: 'sleep', exp: 20, value: 1, unit: 'check' },
      { title: '–ë–µ–∑ —ç–∫—Ä–∞–Ω–∞ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º', description: '30 –º–∏–Ω—É—Ç –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞/–º–æ–Ω–∏—Ç–æ—Ä–∞ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º', category: 'sleep', exp: 15, value: 30, unit: 'min' },
      { title: '–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–Ω–∞', description: '–ù–µ –ø—Ä–æ—Å—ã–ø–∞—Ç—å—Å—è –Ω–æ—á—å—é –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã', category: 'sleep', exp: 25, value: 1, unit: 'check' }
    ]
  },
  {
    id: 'training_ground',
    name: '–§–∏–∑–∏—á–µ—Å–∫–∞—è –§–æ—Ä–º–∞',
    tvaName: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–∞—è –§–µ—Ä–º–∞',
    description: '–°–∏–ª—å–Ω–æ–µ —Ç–µ–ª–æ –¥–µ—Ä–∂–∏—Ç —Å–∏–ª—å–Ω—ã–π –¥—É—Ö.',
    icon: Activity,
    color: 'text-emerald-400',
    category: 'sport',
    defaultTasks: [
      { title: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞', description: '–í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–Ω–µ–≤–Ω—É—é –Ω–æ—Ä–º—É', category: 'sport', exp: 30, value: 20, unit: 'min' },
      { title: '–†–∞–∑–º–∏–Ω–∫–∞', description: '–†–∞—Å—Ç—è–∂–∫–∞ –ø–µ—Ä–µ–¥ —Ç–æ—Ä–≥–∞–º–∏', category: 'sport', exp: 10, value: 5, unit: 'min' },
      { title: '–ü—Ä–æ–≥—É–ª–∫–∞', description: '–ú–∏–Ω–∏–º—É–º 5 000 —à–∞–≥–æ–≤', category: 'sport', exp: 20, value: 5000, unit: 'steps' },
      { title: '–ì–ª–∞–∑–∞ —Ç—Ä–µ–π–¥–µ—Ä–∞', description: '–°–¥–µ–ª–∞—Ç—å –≥–∏–º–Ω–∞—Å—Ç–∏–∫—É –¥–ª—è –≥–ª–∞–∑', category: 'sport', exp: 10, value: 1, unit: 'check' }
    ]
  },
  {
    id: 'chart_tower',
    name: '–ê–Ω–∞–ª–∏–∑ –†—ã–Ω–∫–∞',
    tvaName: '–ú—ç—Ä–∏—è –ì—Ä–∞—Ñ–∏–∫–æ–≤',
    description: '–ü–æ–Ω–∏–º–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä—ã–Ω–∫–∞.',
    icon: TrendingUp,
    color: 'text-amber-400',
    category: 'charts',
    defaultTasks: [
      { title: '–£—Ç—Ä–µ–Ω–Ω–∏–π –ê–Ω–∞–ª–∏–∑', description: '–†–∞–∑–æ–±—Ä–∞—Ç—å 2 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞', category: 'charts', exp: 25, value: 2, unit: 'charts' },
      { title: '–ñ—É—Ä–Ω–∞–ª –°–¥–µ–ª–æ–∫', description: '–û–±–∑–æ—Ä –≤—á–µ—Ä–∞—à–Ω–∏—Ö —Ç—Ä–µ–π–¥–æ–≤', category: 'charts', exp: 15, value: 1, unit: 'session' },
      { title: '–°–∫—Ä–∏–Ω—à–æ—Ç—ã', description: '–°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—ã 3 —Å–µ—Ç–∞–ø–æ–≤ –≤ –∞—Ä—Ö–∏–≤', category: 'charts', exp: 20, value: 3, unit: 'setups' },
      { title: '–û—à–∏–±–∫–∏ –¥–Ω—è', description: '–û—Ç–º–µ—Ç–∏—Ç—å –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É –æ—à–∏–±–∫—É –≤ —Å–¥–µ–ª–∫–∞—Ö', category: 'charts', exp: 15, value: 1, unit: 'check' }
    ]
  },
  {
    id: 'library',
    name: '–û–±—É—á–µ–Ω–∏–µ',
    tvaName: '–í–µ–ª–∏–∫–∏–π –°–æ–±–æ—Ä',
    description: '–ó–Ω–∞–Ω–∏—è ‚Äî —Ç–≤–æ–µ –≥–ª–∞–≤–Ω–æ–µ –ø–ª–µ—á–æ.',
    icon: BookOpen,
    color: 'text-blue-400',
    category: 'learning',
    defaultTasks: [
      { title: '–ß—Ç–µ–Ω–∏–µ –ö–Ω–∏–≥–∏', description: '–ß–∏—Ç–∞—Ç—å –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—É', category: 'learning', exp: 20, value: 10, unit: 'pages' },
      { title: '–û–±—É—á–∞—é—â–µ–µ –í–∏–¥–µ–æ', description: '–°–º–æ—Ç—Ä–µ—Ç—å —É—Ä–æ–∫', category: 'learning', exp: 15, value: 1, unit: 'video' },
      { title: '–ö–æ–Ω—Å–ø–µ–∫—Ç', description: '–°–¥–µ–ª–∞—Ç—å –∑–∞–ø–∏—Å–∏ –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª—É', category: 'learning', exp: 20, value: 1, unit: 'session' },
      { title: '–ü–æ–≤—Ç–æ—Ä', description: '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç –ø—Ä–æ—à–ª–æ–≥–æ –¥–Ω—è', category: 'learning', exp: 15, value: 1, unit: 'session' }
    ]
  },
  {
    id: 'research_house',
    name: '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è',
    tvaName: '–•–∏–∂–∏–Ω–∞ –°—Ç–∞—Ä–æ–≥–æ –¢—Ä–µ–π–¥–µ—Ä–∞',
    description: '–ò—â–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, —Å—Ç—Ä–æ–π –ø–ª–∞–Ω—ã.',
    icon: Target,
    color: 'text-red-400',
    category: 'research',
    defaultTasks: [
      { title: '–û—Ö–æ—Ç–∞ –Ω–∞ –ü–∞—Ç—Ç–µ—Ä–Ω—ã', description: '–ù–∞–π—Ç–∏ 3 —Å–µ—Ç–∞–ø–∞ –Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏', category: 'research', exp: 40, value: 3, unit: 'setups' },
      { title: '–¢–æ—Ä–≥–æ–≤—ã–π –ü–ª–∞–Ω', description: '–ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∑–∏—Å –¥–ª—è —Å–¥–µ–ª–∫–∏', category: 'planning', exp: 30, value: 1, unit: 'plan' },
      { title: '–°—Ü–µ–Ω–∞—Ä–∏–∏', description: '–ü—Ä–æ–ø–∏—Å–∞—Ç—å 2 –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è –ø–æ —Ä—ã–Ω–∫—É', category: 'research', exp: 25, value: 2, unit: 'scenario' },
      { title: '–ß–µ–∫-–ª–∏—Å—Ç –≤—Ö–æ–¥–∞', description: '–ü—Ä–æ–π—Ç–∏—Å—å –ø–æ —á–µ–∫-–ª–∏—Å—Ç—É –ø–µ—Ä–µ–¥ —Å–¥–µ–ª–∫–æ–π', category: 'planning', exp: 20, value: 1, unit: 'check' }
    ]
  }
];


        const UPGRADES = [
          { locationId: 'sleep_house', name: '–ë–∞–Ω—è –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è', maxLevel: 3, steps: [
            { level: 1, cost: 0, visual: '‚õ∫', name: '–í–µ—Ç—Ö–∞—è –ü–∞–ª–∞—Ç–∫–∞' }, { level: 2, cost: 300, visual: 'üèöÔ∏è', name: '–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π –î–æ–º' }, { level: 3, cost: 1200, visual: 'üëë', name: '–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–µ –ü–æ–∫–æ–∏' }
          ] },
          { locationId: 'training_ground', name: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–∞—è –§–µ—Ä–º–∞', maxLevel: 3, steps: [
            { level: 1, cost: 0, visual: 'üåø', name: '–ü–æ–ª–µ–≤–∞—è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞' }, { level: 2, cost: 400, visual: 'üèãÔ∏è', name: '–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –ó–∞–ª' }, { level: 3, cost: 1500, visual: 'üèüÔ∏è', name: '–û–ª–∏–º–ø–∏–π—Å–∫–∏–π –ö–æ–º–ø–ª–µ–∫—Å' }
          ] },
          { locationId: 'chart_tower', name: '–ú—ç—Ä–∏—è –ì—Ä–∞—Ñ–∏–∫–æ–≤', maxLevel: 3, steps: [
            { level: 1, cost: 0, visual: 'üìú', name: '–ü–µ—Ä–≥–∞–º–µ–Ω—Ç' }, { level: 2, cost: 500, visual: 'üìä', name: '–ú–æ–Ω–∏—Ç–æ—Ä' }, { level: 3, cost: 2000, visual: 'üõ∞Ô∏è', name: '–°–ø—É—Ç–Ω–∏–∫–æ–≤–∞—è –°—Ç–∞–Ω—Ü–∏—è' }
          ] },
          { locationId: 'library', name: '–í–µ–ª–∏–∫–∏–π –°–æ–±–æ—Ä', maxLevel: 3, steps: [
            { level: 1, cost: 0, visual: 'üìö', name: '–ú–∞–ª–µ–Ω—å–∫–∞—è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞' }, { level: 2, cost: 600, visual: 'üèõÔ∏è', name: '–ì–æ—Ä–æ–¥—Å–∫–æ–π –°–æ–±–æ—Ä' }, { level: 3, cost: 2500, visual: 'üîÆ', name: '–°–µ–∫—Ä–µ—Ç–Ω–∞—è –ö–æ–ª–ª–µ–∫—Ü–∏—è' }
          ] },
          { locationId: 'research_house', name: '–•–∏–∂–∏–Ω–∞ –°—Ç–∞—Ä–æ–≥–æ –¢—Ä–µ–π–¥–µ—Ä–∞', maxLevel: 3, steps: [
            { level: 1, cost: 0, visual: 'üß≠', name: '–°—Ç–∞—Ä—ã–π –ö–æ–º–ø–∞—Å' }, { level: 2, cost: 700, visual: 'üî¨', name: '–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –¶–µ–Ω—Ç—Ä' }, { level: 3, cost: 3000, visual: 'üöÄ', name: '–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –ë—É–¥—É—â–µ–≥–æ' }
          ] }
        ];

        const ARTIFACTS_DATA = [
            { baseId: 'charts_boost', name: '–û—á–∫–∏ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞', description: '+20% EXP –∑–∞ –∑–∞–¥–∞—á–∏ –ì—Ä–∞—Ñ–∏–∫–æ–≤', visual: 'üëì', effectType: 'exp_multiplier', effectValue: 1.2, targetCategory: 'charts', isEquippable: true, cost: 5000 },
            { baseId: 'gold_magnet', name: '–ó–æ–ª–æ—Ç–æ–π –ú–∞–≥–Ω–∏—Ç', description: '+10% –ó–æ–ª–æ—Ç–∞ –∑–∞ –ª—é–±—É—é –∑–∞–¥–∞—á—É', visual: 'üß≤', effectType: 'gold_multiplier', effectValue: 1.1, targetCategory: 'all', isEquippable: true, cost: 8000 },
            { baseId: 'sleep_focus', name: '–ü–µ—Ä–æ –°–Ω–∞', description: '+30% EXP –∑–∞ –∑–∞–¥–∞—á–∏ –°–Ω–∞', visual: 'üïäÔ∏è', effectType: 'exp_multiplier', effectValue: 1.3, targetCategory: 'sleep', isEquippable: true, cost: 4000 },
            { baseId: 'sport_haste', name: '–ë–æ—Ç–∏–Ω–∫–∏ –°–∫–æ—Ä–æ—Ö–æ–¥–∞', description: '+25% EXP –∑–∞ –∑–∞–¥–∞—á–∏ –°–ø–æ—Ä—Ç–∞', visual: 'üëü', effectType: 'exp_multiplier', effectValue: 1.25, targetCategory: 'sport', isEquippable: true, cost: 4500 },
            { baseId: 'research_wisdom', name: '–°–≤–∏—Ç–æ–∫ –ú—É–¥—Ä–æ—Å—Ç–∏', description: '+15% EXP –∑–∞ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è', visual: 'üìú', effectType: 'exp_multiplier', effectValue: 1.15, targetCategory: 'research', isEquippable: true, cost: 6000 },
            { baseId: 'learning_book', name: '–§–æ–ª–∏–∞–Ω—Ç –ó–Ω–∞–Ω–∏–π', description: '+20% EXP –∑–∞ –û–±—É—á–µ–Ω–∏–µ', visual: 'üìñ', effectType: 'exp_multiplier', effectValue: 1.2, targetCategory: 'learning', isEquippable: true, cost: 5500 },
        ];

        const TALENTS_DATA = [
            { id: 'focus_1', name: '–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –§–æ–∫—É—Å', description: '+5% –∫ –±–∞–∑–æ–≤–æ–º—É EXP', cost: 500, maxLevel: 3, effect: 'exp_boost', baseValue: 0.05, prereqTalentId: null },
            { id: 'gold_finder_1', name: '–ó–æ–ª–æ—Ç–∞—è –ñ–∏–ª–∞', description: '+10% –∫ –ó–æ–ª–æ—Ç—É –∑–∞ –∑–∞–¥–∞—á–∏', cost: 1000, maxLevel: 3, effect: 'gold_boost', baseValue: 0.1, prereqTalentId: 'focus_1' },
            { id: 'discipline_mastery', name: '–ú–∞—Å—Ç–µ—Ä –î–∏—Å—Ü–∏–ø–ª–∏–Ω—ã', description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ª–∏–º–∏—Ç –∑–∞–¥–∞—á', cost: 2000, maxLevel: 1, effect: 'extra_task_slot', baseValue: 1, prereqTalentId: 'gold_finder_1' },
            { id: 'advanced_focus', name: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –§–æ–∫—É—Å', description: '+10% –∫ –±–∞–∑–æ–≤–æ–º—É EXP', cost: 1500, maxLevel: 2, effect: 'exp_boost', baseValue: 0.10, prereqTalentId: 'focus_1' },
            {
    id: 'more_tasks_ii',
    name: '–ì–∏–ª—å–¥–∏—è –ó–∞–¥–∞—á II',
    description: '–ï—â—ë –±–æ–ª—å—à–µ —Å–ª–æ—Ç–æ–≤ –∑–∞–¥–∞—á –¥–ª—è —Å–∞–º—ã—Ö —É–ø–æ—Ä–Ω—ã—Ö —Ç—Ä–µ–π–¥–µ—Ä–æ–≤.',
    cost: 3,
    maxLevel: 2,
    effect: 'extra_task_slot',
    baseValue: 1,       // +1 —Å–ª–æ—Ç –∑–∞ —É—Ä–æ–≤–µ–Ω—å (–ò–¢–û–ì–û –¥–æ +2)
    prereqId: null,     // –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —Ç–∞–ª–∞–Ω—Ç—É
  },
  {
    id: 'more_tasks_iii',
    name: '–ì–∏–ª—å–¥–∏—è –ó–∞–¥–∞—á III',
    description: '–≠–ª–∏—Ç–∞ TVA –ø–æ–ª—É—á–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞—á –≤ –¥–µ–Ω—å.',
    cost: 5,
    maxLevel: 1,
    effect: 'extra_task_slot',
    baseValue: 2,       // +2 —Å–ª–æ—Ç–∞ –Ω–∞ 1 —É—Ä–æ–≤–Ω–µ
    prereqId: 'more_tasks_ii', // –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø—Ä–æ–∫–∞—á–∫–∏ II (–µ—Å–ª–∏ –ª–æ–≥–∏–∫–∞ prereq –µ—Å—Ç—å)
  },

  {
    id: 'gold_mentor_i',
    name: '–ú–æ–Ω–µ—Ç—ã –ú–∞—Å—Ç–µ—Ä–∞ I',
    description: '–ù–µ–±–æ–ª—å—à–æ–π –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±–æ–Ω—É—Å –∫ –∑–æ–ª–æ—Ç—É –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á.',
    cost: 2,
    maxLevel: 3,
    effect: 'gold_boost',
    baseValue: 0.05,    // +5% –∑–æ–ª–æ—Ç–∞ –∑–∞ —É—Ä–æ–≤–µ–Ω—å (–¥–æ +15%)
    prereqId: null,
  },
  {
    id: 'gold_mentor_ii',
    name: '–ú–æ–Ω–µ—Ç—ã –ú–∞—Å—Ç–µ—Ä–∞ II',
    description: '–°–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç –∑–æ–ª–æ—Ç–∞ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –¥–Ω–∏.',
    cost: 4,
    maxLevel: 2,
    effect: 'gold_boost',
    baseValue: 0.10,    // +10% –∑–∞ —É—Ä–æ–≤–µ–Ω—å (–¥–æ +20%)
    prereqId: 'gold_mentor_i',
  },

  {
    id: 'exp_streak_i',
    name: '–ü—É—Ç—å –£—á–µ–Ω–∏—á–µ—Å—Ç–≤–∞',
    description: '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Å –∑–∞–¥–∞—á–∞–º–∏ –ø—Ä–∏–Ω–æ—Å–∏—Ç —á—É—Ç—å –±–æ–ª—å—à–µ –æ–ø—ã—Ç–∞.',
    cost: 2,
    maxLevel: 3,
    effect: 'exp_boost',
    baseValue: 0.05,    // +5% EXP –∑–∞ —É—Ä–æ–≤–µ–Ω—å
    prereqId: null,
  },
  {
    id: 'exp_streak_ii',
    name: '–ü—É—Ç—å –ú–∞—Å—Ç–µ—Ä–∞',
    description: '–î–ª—è —Ç–µ—Ö, –∫—Ç–æ –¥–µ—Ä–∂–∏—Ç —Å–µ—Ä–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–Ω–µ–π –±–µ–∑ —Å—Ä—ã–≤–æ–≤.',
    cost: 4,
    maxLevel: 2,
    effect: 'exp_boost',
    baseValue: 0.10,    // +10% EXP –∑–∞ —É—Ä–æ–≤–µ–Ω—å
    prereqId: 'exp_streak_i',
  },

  {
    id: 'artifact_master_i',
    name: '–ú–∞—Å—Ç–µ—Ä –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ I',
    description: '–ü–æ–∑–≤–æ–ª—è–µ—Ç —ç–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë –æ–¥–∏–Ω –∞—Ä—Ç–µ—Ñ–∞–∫—Ç.',
    cost: 3,
    maxLevel: 1,
    effect: 'extra_equip_slot',
    baseValue: 1,       // +1 —Å–ª–æ—Ç —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
    prereqId: null,
  },
  {
    id: 'artifact_master_ii',
    name: '–ú–∞—Å—Ç–µ—Ä –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ II',
    description: '–ï—â—ë –æ–¥–∏–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–ª–æ—Ç –¥–ª—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞.',
    cost: 5,
    maxLevel: 1,
    effect: 'extra_equip_slot',
    baseValue: 1,       // –µ—â—ë +1 —Å–ª–æ—Ç
    prereqId: 'artifact_master_i',
  },
        ];

        const INITIAL_PLAYER_STATE = {
  level: 1,
  currentExp: 0,
  expToNextLevel: 100,
  totalExp: 0,
  streakDays: 0,
  lastLoginDate: new Date().toISOString().split('T')[0],
  gold: 10000, 
  equippedArtifactIds: [], 
  unlockedTalents: {},
  buildingTaskSlots: 0,

  // üî• Premium / –ø–æ–¥–ø–∏—Å–∫–∏
  hasPremiumPass: false,        // –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ª–∏ Premium Pass
  subscriptionTier: null,       // 'basic' | 'advanced' | 'pro' (–Ω–∞ –±—É–¥—É—â–µ–µ)
};

        const MOTIVATION_QUOTES = [
  "–ö–∞–∂–¥—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π —à–∞–≥ –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è —Å–∏–ª—å–Ω–µ–µ, —á–µ–º —Ç—ã –±—ã–ª –≤—á–µ—Ä–∞.",
  "–¢–æ—Ä–≥–æ–≤–ª—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã. –î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –æ–¥–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è.",
  "–¢—ã —Å—Ç—Ä–æ–∏—à—å –Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞–≤—ã–∫–∏ ‚Äî —Ç—ã —Å—Ç—Ä–æ–∏—à—å —Å–≤–æ–π –±—É–¥—É—â–∏–π –∫–∞–ø–∏—Ç–∞–ª.",
  "–î–µ—Ä–µ–≤–Ω—è —Ä–∞—Å—Ç—ë—Ç –≤–º–µ—Å—Ç–µ —Å —Ç–æ–±–æ–π. –ü—Ä–æ–¥–æ–ª–∂–∞–π –¥–≤–∏–∂–µ–Ω–∏–µ.",
  "–õ—É—á—à–∏–µ —Ç—Ä–µ–π–¥–µ—Ä—ã ‚Äî —ç—Ç–æ —Ç–µ, –∫—Ç–æ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.",
  "–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –º–∞–ª–µ–Ω—å–∫–∞—è –ø–æ–±–µ–¥–∞ ‚Äî –∑–∞–≤—Ç—Ä–∞—à–Ω–∏–π –±–æ–ª—å—à–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.",
  "–°–∏–ª—å–Ω–∞—è —Ä—É—Ç–∏–Ω–∞ —Å–æ–∑–¥–∞—ë—Ç —Å–∏–ª—å–Ω–æ–≥–æ —Ç—Ä–µ–π–¥–µ—Ä–∞.",
  "–ü–æ–∫–∞ –¥—Ä—É–≥–∏–µ —Å–ø—è—Ç ‚Äî —Ç—ã —Å–æ–∑–¥–∞—ë—à—å –ª–µ–≥–µ–Ω–¥—É.",
  "–®–∞–≥ –∑–∞ —à–∞–≥–æ–º. –î–µ–Ω—å –∑–∞ –¥–Ω—ë–º. –¢–∞–∫ –∏ —Ä–æ–∂–¥–∞—é—Ç—Å—è –º–∞—Å—Ç–µ—Ä–∞.",
  "–§–æ—Ä–º–∏—Ä—É–µ—à—å –ø—Ä–∏–≤—ã—á–∫–∏ ‚Äî —Ñ–æ—Ä–º–∏—Ä—É–µ—à—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç."
];

// üî• –ù–∞—Å—Ç–∞–≤–Ω–∏–∫–∏ TVA
const TVA_MENTORS = {
  trader: {
    name: "–°—Ç–∞—Ä—ã–π –¢—Ä–µ–π–¥–µ—Ä",
    emoji: "üßô‚Äç‚ôÇÔ∏è",
    quotes: [
      "–¢—ã –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—à—å —Ä—ã–Ω–æ–∫ ‚Äî –Ω–æ —Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—à—å —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è.",
      "–õ—É—á—à–∏–π —Ç—Ä–µ–π–¥ ‚Äî —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –Ω–µ –æ—Ç–∫—Ä—ã–ª.",
      "–ó–∞–ø–æ–º–Ω–∏: –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –≤–∞–∂–Ω–µ–µ –ø—Ä–æ–≥–Ω–æ–∑–∞.",
      "–¢–µ—Ä–ø–µ–Ω–∏–µ –ø–ª–∞—Ç–∏—Ç –±–æ–ª—å—à–µ –ª—é–±—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π.",
    ]
  },
  monk: {
    name: "–ú–æ–Ω–∞—Ö –°–ø–æ–∫–æ–π—Å—Ç–≤–∏—è",
    emoji: "üôè",
    quotes: [
      "–¢–æ—Ç, –∫—Ç–æ –ø–æ–±–µ–¥–∏–ª —Å–µ–±—è ‚Äî –ø–æ–±–µ–¥–∏–ª —Ä—ã–Ω–æ–∫.",
      "–¢–≤–æ—è –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å ‚Äî —Ç–≤–æ–π –≥–ª–∞–≤–Ω—ã–π –≤—Ä–∞–≥.",
      "–ù–∞—Å—Ç–æ—è—â–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å ‚Äî —ç—Ç–æ —É–º–µ–Ω–∏–µ –Ω–µ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É.",
      "–î—ã—à–∏. –†—ã–Ω–æ–∫ –Ω–∏–∫—É–¥–∞ –Ω–µ —É–π–¥—ë—Ç.",
    ]
  },
  grandpa: {
    name: "–î–µ–¥ –ê–Ω–∞–ª–∏—Ç–∏–∫",
    emoji: "üìà",
    quotes: [
      "–Ø –≤–∏–¥–µ–ª —Ç–∞–∫–∏–µ —Ä—ã–Ω–∫–∏ –µ—â—ë –¥–æ —Ç–≤–æ–µ–≥–æ —Ä–æ–∂–¥–µ–Ω–∏—è.",
      "–ï—Å–ª–∏ –≥—Ä–∞—Ñ–∏–∫ —Ä–∞—Å—Ç—ë—Ç ‚Äî –Ω–µ –º–µ—à–∞–π –µ–º—É.",
      "–ï—Å–ª–∏ –ø–∞–¥–∞–µ—Ç ‚Äî –Ω–µ —É—Å–ª–æ–∂–Ω—è–π.",
      "–°–∞–º–∞—è –¥–æ—Ä–æ–≥–∞—è –æ—à–∏–±–∫–∞ —Ç—Ä–µ–π–¥–µ—Ä–∞ ‚Äî –ø–µ—Ä–µ–æ—Ü–µ–Ω–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è.",
    ]
  }
};

function getRandomAdvice() {
  const mentors = Object.values(TVA_MENTORS);
  const mentor = mentors[Math.floor(Math.random() * mentors.length)];
  const quote = mentor.quotes[Math.floor(Math.random() * mentor.quotes.length)];

  return {
    mentor: mentor.name,
    emoji: mentor.emoji,
    text: quote
  };
}

        const INITIAL_UPGRADES_STATE = Object.fromEntries(
            LOCATIONS.map(loc => [loc.id, 1])
        );

        // --- SERVICES ---

        const STORAGE_KEYS = {
          PROFILE: 'tva_profile',
          PLAYER: 'tva_player',
          TASKS: 'tva_tasks',
          STATS: 'tva_stats',
          UPGRADES: 'tva_upgrades',
          ARTIFACTS: 'tva_artifacts',
          CHALLENGE: 'tva_weekly_challenge',
        };

        const getSubscriptionBonuses = (tier) => {
          switch (tier) {
            case 'advanced':
              return {
                extraTaskSlots: 1,     // +1 —Å–ª–æ—Ç –∑–∞–¥–∞—á
                extraEquipSlots: 1,    // +1 —Å–ª–æ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
                goldMultiplier: 1.1,   // +10% –∑–æ–ª–æ—Ç–∞
              };
            case 'pro':
              return {
                extraTaskSlots: 2,     // +2 —Å–ª–æ—Ç–∞ –∑–∞–¥–∞—á
                extraEquipSlots: 2,    // +2 —Å–ª–æ—Ç–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
                goldMultiplier: 1.2,   // +20% –∑–æ–ª–æ—Ç–∞
              };
            case 'basic':
            default:
              return {
                extraTaskSlots: 0,
                extraEquipSlots: 0,
                goldMultiplier: 1.0,
              };
          }
        };

        const calculateMaxEquipSlots = (player) => {
  const baseSlots = 3; // –±–∞–∑–æ–≤—ã–µ —Å–ª–æ—Ç—ã

  const subBonuses = getSubscriptionBonuses(player.subscriptionTier || 'basic');
  const fromSub = subBonuses.extraEquipSlots || 0;

  const fromPremium = player.hasPremiumPass ? 1 : 0; // –∑–∞ Premium Pass –µ—â—ë +1

  // üî• –±–æ–Ω—É—Å—ã –æ—Ç —Ç–∞–ª–∞–Ω—Ç–æ–≤ "–ú–∞—Å—Ç–µ—Ä –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤"
  const fromTalents = Object.entries(player.unlockedTalents || {}).reduce(
    (total, [id, level]) => {
      const talent = TALENTS_DATA.find(t => t.id === id);
      if (talent && talent.effect === 'extra_equip_slot') {
        return total + (talent.baseValue || 0) * level;
      }
      return total;
    },
    0
  );

  return baseSlots + fromSub + fromPremium + fromTalents;
};

        const getTodayString = () => new Date().toISOString().split('T')[0];

        const getWeekId = (dateString) => {
            const date = dateString ? new Date(dateString) : new Date();
            const startOfWeek = new Date(date.setDate(date.getDate() - date.getDay()));
            return startOfWeek.toISOString().split('T')[0];
        };

        const calculateLevel = (currentLevel, currentExp, expNeeded) => {
          if (currentExp >= expNeeded) {
            const overflow = currentExp - expNeeded;
            const nextLevel = currentLevel + 1;
            const nextNeeded = 100 + (nextLevel * 20);
            return { newLevel: nextLevel, newExp: overflow, newNeeded: nextNeeded, leveledUp: true };
          }
          return { newLevel: currentLevel, newExp: currentExp, newNeeded: expNeeded, leveledUp: false };
        };

        const generateDailyTasks = (date, extraSlots) => {
          let tasks = [];
          LOCATIONS.forEach(loc => {
            loc.defaultTasks.forEach((dt, idx) => {
              tasks.push({
                id: `${date}-${loc.id}-${idx}`,
                ...dt,
                completed: false,
              });
            });
          });
          for (let i = 0; i < extraSlots; i++) {
            const bonusTask = { title: `–ë–æ–Ω—É—Å–Ω–∞—è –î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ ${i+1}`, description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è —Ä–æ—Å—Ç–∞', category: 'planning', exp: 10, value: 1, unit: 'check' };
            tasks.push({ id: `${date}-bonus-${i}`, ...bonusTask, completed: false });
          }
          return tasks;
        };

        const generateWeeklyChallenge = (today) => {
            const categories = ['sport', 'charts', 'learning', 'research'];
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const required = 10 + Math.floor(Math.random() * 5); 
            const exp = required * 80;
            const gold = required * 120;
            
            const categoryName = LOCATIONS.find(l => l.category === randomCategory)?.name || '–ö–∞—Ç–µ–≥–æ—Ä–∏—è';

            return {
                id: crypto.randomUUID(),
                startDate: today,
                title: `–ò—Å–ø—ã—Ç–∞–Ω–∏–µ: –ú–∞—Å—Ç–µ—Ä ${categoryName}`,
                description: `–í—ã–ø–æ–ª–Ω–∏ ${required} –∑–∞–¥–∞—á –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${categoryName}" –∑–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é, —á—Ç–æ–±—ã –æ–¥–æ–ª–µ—Ç—å –ë–æ—Å—Å–∞!`,
                targetCategory: randomCategory,
                requiredCompletions: required,
                currentProgress: 0,
                expReward: exp,
                goldReward: gold,
                isCompleted: false,
                isClaimed: false,
            };
        };

        const generateRandomArtifact = () => {
            const baseArtifact = ARTIFACTS_DATA[Math.floor(Math.random() * ARTIFACTS_DATA.length)];
            return { ...baseArtifact, id: crypto.randomUUID() };
        };

        const getCurrentUpgrade = (locationId, currentLevel) => {
            const upgradeSet = UPGRADES.find(u => u.locationId === locationId);
            if (!upgradeSet) return null;
            return upgradeSet.steps.find(s => s.level === currentLevel) || upgradeSet.steps[0];
        };

        const getNextUpgrade = (locationId, currentLevel) => {
            const upgradeSet = UPGRADES.find(u => u.locationId === locationId);
            if (!upgradeSet || currentLevel >= upgradeSet.maxLevel) return null;
            return upgradeSet.steps.find(s => s.level === currentLevel + 1);
        };

        // --- SUB-COMPONENTS ---

        const PixelCard = ({ children, className = "", onClick }) => (
          <div 
            onClick={onClick}
            className={`
              bg-[#151a25] border-2 border-[#2a3441] rounded-lg p-4 relative shadow-lg
              hover:border-[#3b4a5c] transition-colors
              ${onClick ? 'cursor-pointer active:scale-[0.98]' : ''}
              ${className}
            `}
          >
            {children}
          </div>
        );

        const MotivationFooter = ({ viewKey }) => {
  const [advice, setAdvice] = useState(() => getRandomAdvice());

  useEffect(() => {
    // –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ viewKey –º–µ–Ω—è–µ—Ç—Å—è ‚Äî –±–µ—Ä—ë–º –Ω–æ–≤—ã–π —Å–æ–≤–µ—Ç
    setAdvice(getRandomAdvice());
  }, [viewKey]);

  return (
    <div className="text-center mt-10 mb-2 px-4 opacity-70">
      <div className="text-[11px] text-gray-400 font-semibold">
        {advice.emoji} {advice.mentor} –≥–æ–≤–æ—Ä–∏—Ç:
      </div>
      <div className="text-[10px] text-gray-500 mt-1 italic">
        "{advice.text}"
      </div>
    </div>
  );
};



        const Button = ({ children, onClick, variant = 'primary', className = "", disabled = false }) => {
          const baseStyle = "px-4 py-2 font-bold uppercase tracking-wider text-xs sm:text-sm border-b-4 transition-all rounded";
          const variants = {
            primary: "bg-[#2563eb] border-[#1d4ed8] text-white hover:bg-[#3b82f6] active:border-b-0 active:translate-y-1 disabled:opacity-50 disabled:translate-y-0 disabled:border-b-4 disabled:cursor-not-allowed",
            secondary: "bg-[#334155] border-[#1e293b] text-gray-200 hover:bg-[#475569] active:border-b-0 active:translate-y-1 disabled:opacity-50 disabled:translate-y-0 disabled:border-b-4 disabled:cursor-not-allowed",
            accent: "bg-[#d97706] border-[#b45309] text-white hover:bg-[#f59e0b] active:border-b-0 active:translate-y-1 disabled:opacity-50 disabled:translate-y-0 disabled:border-b-4 disabled:cursor-not-allowed",
            success: "bg-emerald-600 border-emerald-800 text-white hover:bg-emerald-500 active:border-b-0 active:translate-y-1 disabled:opacity-50 disabled:translate-y-0 disabled:border-b-4 disabled:cursor-not-allowed",
          };
          
          return (
            <button onClick={onClick} disabled={disabled} className={`${baseStyle} ${variants[variant]} ${className}`}>
              {children}
            </button>
          );
        };

        const ProgressBar = ({ current, max, colorClass = "bg-yellow-500" }) => {
          const percent = Math.min(100, (current / max) * 100);
          return (
            <div className="h-4 bg-gray-800 rounded-full overflow-hidden border border-gray-700 relative">
              <div 
                className={`h-full ${colorClass} transition-all duration-500 ease-out`}
                style={{ width: `${percent}%` }}
              />
              <span className="absolute inset-0 flex items-center justify-center text-[9px] font-bold text-white shadow-black drop-shadow-md">
                {current} / {max} EXP
              </span>
            </div>
          );
        };

        // Radar Chart
const RadarChart = ({ data }) => {
  // üîπ –§–æ–ª–±—ç–∫, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –∏–ª–∏ –æ–Ω–∏ –ø—É—Å—Ç—ã–µ
  const fallbackData = [
    { label: '–°–æ–Ω',      value: 0, fullMark: 20 },
    { label: '–°–ø–æ—Ä—Ç',    value: 0, fullMark: 20 },
    { label: '–ì—Ä–∞—Ñ–∏–∫–∏',  value: 0, fullMark: 20 },
    { label: '–ó–Ω–∞–Ω–∏—è',   value: 0, fullMark: 20 },
    { label: '–°—Ç—Ä–∞—Ç–µ–≥–∏—è',value: 0, fullMark: 20 },
  ];

  const chartData = (data && data.length > 0) ? data : fallbackData;

  const size = 200;
  const center = size / 2;
  const radius = (size / 2) - 30;
  const total = chartData.length;
  const angleSlice = (Math.PI * 2) / total;

  const getCoords = (value, index, max) => {
    const r = (value / max) * radius;
    const angle = index * angleSlice - Math.PI / 2;
    return {
      x: center + r * Math.cos(angle),
      y: center + r * Math.sin(angle)
    };
  };

  const levels = [0.2, 0.4, 0.6, 0.8, 1];

  const points = chartData
    .map((d, i) => {
      const val = Math.min(d.value, d.fullMark);
      const { x, y } = getCoords(val, i, d.fullMark);
      return `${x},${y}`;
    })
    .join(' ');

  return (
    <div className="flex flex-col items-center">
      <svg width={size} height={size} className="overflow-visible">
        {/* –°–µ—Ç–æ—á–Ω–∞—è ¬´–ø–∞—É—Ç–∏–Ω–∫–∞¬ª */}
        {levels.map((level, lvlIdx) => (
          <polygon
            key={lvlIdx}
            points={chartData.map((d, i) => {
              const { x, y } = getCoords(d.fullMark * level, i, d.fullMark);
              return `${x},${y}`;
            }).join(' ')}
            fill="none"
            stroke="#2a3441"
            strokeWidth="1"
          />
        ))}

        {/* –†–∞–¥–∏–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ */}
        {chartData.map((d, i) => {
          const { x, y } = getCoords(d.fullMark, i, d.fullMark);
          return (
            <line
              key={i}
              x1={center}
              y1={center}
              x2={x}
              y2={y}
              stroke="#2a3441"
              strokeWidth="1"
            />
          );
        })}

        {/* –ú–Ω–æ–≥–æ—É–≥–æ–ª—å–Ω–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */}
        <polygon
          points={points}
          fill="rgba(234, 179, 8, 0.3)"
          stroke="#eab308"
          strokeWidth="2"
        />

        {/* –¢–æ—á–∫–∏ –Ω–∞ –≤–µ—Ä—à–∏–Ω–∞—Ö */}
        {chartData.map((d, i) => {
          const val = Math.min(d.value, d.fullMark);
          const { x, y } = getCoords(val, i, d.fullMark);
          return <circle key={i} cx={x} cy={y} r="3" fill="#eab308" />;
        })}

        {/* –ü–æ–¥–ø–∏—Å–∏ –æ—Å–µ–π */}
        {chartData.map((d, i) => {
          const labelRadius = radius + 15;
          const angle = i * angleSlice - Math.PI / 2;
          const x = center + labelRadius * Math.cos(angle);
          const y = center + labelRadius * Math.sin(angle);

          return (
            <text
              key={i}
              x={x}
              y={y}
              textAnchor="middle"
              dy="0.3em"
              fill="#9ca3af"
              className="text-[10px] uppercase font-bold"
            >
              {d.label}
            </text>
          );
        })}
      </svg>

      {/* –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ–ª–±—ç–∫ ‚Äî –ø–æ–∫–∞–∂–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É */}
      {(!data || data.length === 0) && (
        <p className="text-[10px] text-gray-500 mt-2 text-center max-w-xs">
          –ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞–¥–∞—á–∞–º ‚Äî –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω.
          –í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞—á–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å.
        </p>
      )}
    </div>
  );
};

// === –ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞: –æ—Å–∏ –∏ –≤–æ–ø—Ä–æ—Å—ã ===
const BALANCE_DIMENSIONS = [
  { id: 'discipline', label: '–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞' },
  { id: 'energy',     label: '–≠–Ω–µ—Ä–≥–∏—è' },
  { id: 'focus',      label: '–§–æ–∫—É—Å' },
  { id: 'emotions',   label: '–≠–º–æ—Ü–∏–∏' },
  { id: 'finances',   label: '–§–∏–Ω–∞–Ω—Å—ã' },
];

const BALANCE_QUESTIONS = [
  { id: 'q1',  dimension: 'discipline', text: '–Ø –≤—ã–ø–æ–ª–Ω—è—é –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–∞–∂–µ –∫–æ–≥–¥–∞ –Ω–µ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–∏.' },
  { id: 'q2',  dimension: 'discipline', text: '–£ –º–µ–Ω—è –µ—Å—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–π —Ä–∞—Å–ø–æ—Ä—è–¥–æ–∫ –¥–Ω—è.' },
  { id: 'q3',  dimension: 'energy',     text: '–Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –±–æ–¥—Ä–æ –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å –¥–Ω—è.' },
  { id: 'q4',  dimension: 'energy',     text: '–Ø —Å–ª–µ–∂—É –∑–∞ —Å–Ω–æ–º –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º.' },
  { id: 'q5',  dimension: 'focus',      text: '–ú–Ω–µ –ª–µ–≥–∫–æ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ –±–µ–∑ –æ—Ç–≤–ª–µ—á–µ–Ω–∏–π.' },
  { id: 'q6',  dimension: 'focus',      text: '–í–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —è —Ä–µ–¥–∫–æ –ø—Ä–æ–≤–µ—Ä—è—é —Å–æ—Ü—Å–µ—Ç–∏ –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã.' },
  { id: 'q7',  dimension: 'emotions',   text: '–Ø —É–º–µ—é –¥–µ—Ä–∂–∞—Ç—å —ç–º–æ—Ü–∏–∏ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –¥–∞–∂–µ –ø–æ—Å–ª–µ —Å–ª–æ–∂–Ω–æ–≥–æ –¥–Ω—è.' },
  { id: 'q8',  dimension: 'emotions',   text: '–ü—Ä–æ—Å–∞–¥–∫–∏ –∏ –æ—à–∏–±–∫–∏ –Ω–µ –ª–æ–º–∞—é—Ç –º–Ω–µ –¥–µ–Ω—å –∏ —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É.' },
  { id: 'q9',  dimension: 'finances',   text: '–£ –º–µ–Ω—è –µ—Å—Ç—å –±–∞–∑–æ–≤—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞–Ω –∏–ª–∏ –ø–æ–¥—É—à–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.' },
  { id: 'q10', dimension: 'finances',   text: '–Ø –ø–æ–Ω–∏–º–∞—é, –∫–∞–∫ —Å–≤—è–∑–∞–Ω—ã –º–æ–∏ –ø—Ä–∏–≤—ã—á–∫–∏ –∏ –º–æ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.' },
];

const BalanceTestView = ({ profile, onComplete, onBack }) => {
  const [answers, setAnswers] = React.useState({});

  const handleAnswer = (questionId, value) => {
    setAnswers(prev => ({ ...prev, [questionId]: value }));
  };

  const allAnswered = BALANCE_QUESTIONS.every(q => answers[q.id]);

  const handleSubmit = () => {
    if (!allAnswered) return;

    const totals = {};
    const counts = {};

    BALANCE_QUESTIONS.forEach(q => {
      const v = answers[q.id];
      if (!totals[q.dimension]) {
        totals[q.dimension] = 0;
        counts[q.dimension] = 0;
      }
      totals[q.dimension] += v;
      counts[q.dimension] += 1;
    });

    const scores = {};
    BALANCE_DIMENSIONS.forEach(dim => {
      const sum = totals[dim.id] || 0;
      const cnt = counts[dim.id] || 1;
      const avg = sum / cnt; // 1‚Äì5
      scores[dim.id] = Math.round((avg / 5) * 100); // 0‚Äì100
    });

    onComplete(scores);
  };

  return (
    <div className="space-y-6 animate-in slide-in-from-right-8 duration-300">
      <button
        onClick={onBack}
        className="text-xs text-gray-400 hover:text-white flex items-center gap-1 mb-2"
      >
        <Home size={12} /> –í–ï–†–ù–£–¢–¨–°–Ø –í –î–ï–†–ï–í–ù–Æ
      </button>

      <h2 className="text-xl font-bold text-white mb-2 border-b border-gray-800 pb-2">
        –¢–µ—Å—Ç ¬´–ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞¬ª
      </h2>

      {/* –¶–∏—Ç–∞—Ç–∞ –æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –±–∞–ª–∞–Ω—Å–∞ */}
<PixelCard
  className="
    bg-gray-900/40 border-gray-700/40 mb-2
    animate-in fade-in slide-in-from-top-2 duration-500
  "
>
  <p className="text-xs italic text-gray-300">
    ¬´–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ ‚Äî —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —á–µ—Å—Ç–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ —É–ª—É—á—à–∞—Ç—å —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã.¬ª
  </p>
  <p className="text-[10px] text-gray-500 mt-1">
    ‚Äî –†—ç–π –î–∞–ª–∏–æ
  </p>
</PixelCard>

      <PixelCard className="bg-gray-900/70 border-yellow-500/40">
        <p className="text-xs text-gray-300">
          –û—Ç–º–µ—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å —Ç–æ–±–æ–π —Å–æ–≥–ª–∞—Å–Ω—ã —ç—Ç–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.
          –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ —Å—Ñ–µ—Ä—ã —Å–µ–π—á–∞—Å –ø—Ä–æ—Å–µ–¥–∞—é—Ç –∏ —á—Ç–æ —Å—Ç–æ–∏—Ç —É—Å–∏–ª–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å.
        </p>
      </PixelCard>

      <div className="space-y-4 max-h-[55vh] overflow-y-auto pr-1">
        {BALANCE_QUESTIONS.map((q, idx) => (
          <PixelCard key={q.id} className="bg-[#111827] border-gray-800">
            <p className="text-xs text-gray-300 mb-3">
              <span className="text-yellow-400 mr-1">#{idx + 1}</span>
              {q.text}
            </p>
            <div className="flex justify-between gap-1">
              {[1, 2, 3, 4, 5].map(v => (
                <button
                  key={v}
                  onClick={() => handleAnswer(q.id, v)}
                  className={
                    "flex-1 text-[10px] py-1 rounded border " +
                    (answers[q.id] === v
                      ? "bg-yellow-500 border-yellow-400 text-black font-bold"
                      : "bg-gray-900 border-gray-700 text-gray-300")
                  }
                >
                  {v}
                </button>
              ))}
            </div>
            <p className="text-[10px] text-gray-500 mt-1">
              1 ‚Äî —Å–æ–≤—Å–µ–º –Ω–µ –ø—Ä–æ –º–µ–Ω—è ¬∑ 5 ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ –º–µ–Ω—è
            </p>
          </PixelCard>
        ))}
      </div>

      <Button
        onClick={handleSubmit}
        disabled={!allAnswered}
        variant={allAnswered ? 'accent' : 'secondary'}
        className="w-full py-3 mt-2"
      >
        {allAnswered ? '–°–§–û–†–ú–ò–†–û–í–ê–¢–¨ –ö–û–õ–ï–°–û –ë–ê–õ–ê–ù–°–ê' : '–û–¢–í–ï–¢–¨ –ù–ê –í–°–ï –í–û–ü–†–û–°–´'}
      </Button>
    </div>
  );
};

const getBalanceRecommendationsFromScores = (scores) => {
  const recs = [];

  if (scores.discipline < 60) {
    recs.push("–£–∫—Ä–µ–ø–∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É: —Ñ–∏–∫—Å–∏—Ä—É–π –∑–∞–¥–∞—á–∏, —Å—Ç–∞–≤—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –æ—Ç–º–µ—á–∞–π –∏—Ö –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.");
  }
  if (scores.energy < 60) {
    recs.push("–ü–æ–¥–Ω–∏–º–∏ —É—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏: —Ä–µ–∂–∏–º —Å–Ω–∞, –¥–≤–∏–∂–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ä—ã–≤—ã ‚Äî –±–µ–∑ —ç—Ç–æ–≥–æ –±—É–¥–µ—Ç —Ç—Ä—É–¥–Ω–æ –¥–µ—Ä–∂–∞—Ç—å —Ñ–æ–∫—É—Å –≤ —Ç—Ä–µ–π–¥–∏–Ω–≥–µ.");
  }
  if (scores.focus < 60) {
    recs.push("–ü–æ—Ä–∞–±–æ—Ç–∞–π –Ω–∞–¥ —Ñ–æ–∫—É—Å–æ–º: –±–ª–æ–∫–∏ Deep Work –±–µ–∑ –æ—Ç–≤–ª–µ—á–µ–Ω–∏–π –ø–æ–º–æ–≥—É—Ç –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–æ–∫–∞—á–∞—Ç—å –Ω–∞–≤—ã–∫–∏.");
  }
  if (scores.emotions < 60) {
    recs.push("–£–∫—Ä–µ–ø–ª—è–π —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: —Ä–µ—Ñ–ª–µ–∫—Å–∏—è, –¥–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–π–¥–µ—Ä–∞ –∏ —Ä–∞–±–æ—Ç–∞ —Å —Ä–µ–∞–∫—Ü–∏—è–º–∏ –Ω–∞ –ø—Ä–æ—Å–∞–¥–∫–∏.");
  }
  if (scores.finances < 60) {
    recs.push("–£—Å–∏–ª–∏–≤–∞–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç: –±–∞–∑–æ–≤—ã–π –ø–ª–∞–Ω, –ø–æ–¥—É—à–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —á—ë—Ç–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∏—Å–∫–æ–≤.");
  }

  if (recs.length === 0) {
    recs.push("–¢–≤–æ—ë –∫–æ–ª–µ—Å–æ –≤—ã–≥–ª—è–¥–∏—Ç –æ—á–µ–Ω—å —Ä–æ–≤–Ω–æ ‚Äî –º–æ–∂–µ—à—å –≤—ã–±–∏—Ä–∞—Ç—å –ª—é–±—É—é —Å—Ñ–µ—Ä—É –∏ –∫–∞—á–∞—Ç—å –µ—ë –≤–≥–ª—É–±—å, —É—Å–∏–ª–∏–≤–∞—è —É–∂–µ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã.");
  }

  return recs;
};

const BalanceResultsView = ({ profile, onBack }) => {
  if (!profile?.balanceScores) return null;

  const scores = profile.balanceScores;
  const radarData = BALANCE_DIMENSIONS.map(dim => ({
    label: dim.label,
    value: scores[dim.id] || 0,
    fullMark: 100,
  }));

  const recs = getBalanceRecommendationsFromScores(scores);

  return (
    <div className="space-y-6 animate-in slide-in-from-right-8 duration-300">
      <button
        onClick={onBack}
        className="text-xs text-gray-400 hover:text-white flex items-center gap-1 mb-2"
      >
        <Home size={12} /> –í–ï–†–ù–£–¢–¨–°–Ø –í –î–ï–†–ï–í–ù–Æ
      </button>

      <h2 className="text-xl font-bold text-white mb-4 border-b border-gray-800 pb-2">
        –¢–≤–æ—ë –ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞
      </h2>

      <PixelCard className="flex flex-col items-center justify-center pt-8 pb-4">
        <h3 className="text-xs uppercase tracking-widest text-gray-500 font-bold mb-4">
          –ö–∞—Ä—Ç–∞ –°–æ—Å—Ç–æ—è–Ω–∏—è
        </h3>
        <RadarChart data={radarData} />
        <p className="text-[10px] text-gray-500 mt-4 text-center max-w-xs">
          –≠—Ç–æ —Ç–≤–æ—ë —Ç–µ–∫—É—â–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏–ª: –≥–¥–µ —Ç—ã —Å—Ç–∞–±–∏–ª–µ–Ω, –∞ –≥–¥–µ –Ω—É–∂–Ω–∞ –ø—Ä–æ–∫–∞—á–∫–∞,
          —á—Ç–æ–±—ã –¥–≤–∏–≥–∞—Ç—å—Å—è –æ—Ç –ù–æ–≤–∏—á–∫–∞ –∫ –ö–æ—Ä–æ–ª—é –ñ–∏–∑–Ω–∏.
        </p>
      </PixelCard>

      <PixelCard className="border-emerald-500/30 bg-emerald-900/10">
        <div className="flex items-center gap-2 mb-3 text-emerald-400">
          <Target size={18} />
          <h3 className="font-bold text-sm uppercase">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é</h3>
        </div>
        <ul className="space-y-2">
          {recs.map((rec, idx) => (
            <li
              key={idx}
              className="text-xs text-gray-300 flex items-start gap-2 bg-black/30 p-2 rounded"
            >
              <span className="mt-0.5 text-emerald-500">‚û§</span> {rec}
            </li>
          ))}
        </ul>
      </PixelCard>
    </div>
  );
};

        const TalentTreeView = ({ talentsData, unlockedTalents, currentGold, onUnlock, onBack }) => {
            return (
                <div className="space-y-6 animate-in slide-in-from-right-8 duration-300">
                    <button onClick={onBack} className="text-xs text-gray-400 hover:text-white flex items-center gap-1 mb-2">
                        <Home size={12}/> –í–ï–†–ù–£–¢–¨–°–Ø –í –î–ï–†–ï–í–ù–Æ
                    </button>
                    <h2 className="text-xl font-bold text-white mb-4 border-b border-gray-800 pb-2 flex items-center gap-2">
                        <Star size={24} className="text-purple-400"/> –î–ï–†–ï–í–û –¢–ê–õ–ê–ù–¢–û–í
                    </h2>

                    <PixelCard className="bg-gray-900 border-yellow-500/30">
                        <div className="flex items-center justify-between">
                            <span className="text-sm text-gray-400">–¢–≤–æ–µ –ó–æ–ª–æ—Ç–æ:</span>
                            <span className="text-2xl font-bold text-yellow-400 flex items-center gap-2">
                                {currentGold} ü™ô
                            </span>
                        </div>
                    </PixelCard>

                    <div className="space-y-4">
                        {talentsData.map((talent, index) => {
                            const currentLevel = unlockedTalents[talent.id] || 0;
const nextLevel = currentLevel + 1;
const nextCost = talent.cost * nextLevel;
const isMaxLevel = currentLevel >= talent.maxLevel;
const isLocked = talent.prereqTalentId && (unlockedTalents[talent.prereqTalentId] || 0) < 1;
const canAfford = currentGold >= nextCost;

const description = isMaxLevel
  ? '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Ç–∞–ª–∞–Ω—Ç–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç.'
  : talent.description;

// üî• –¢–∞–ª–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç —Å–ª–æ—Ç—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
const isArtifactSlotTalent =
  talent.effect === 'extra_equip_slot' ||
  (talent.id && talent.id.startsWith('artifact_master'));
  const isSubscriptionSynergyTalent =
  talent.effect === 'exp_boost' ||
  talent.effect === 'gold_boost' ||
  talent.effect === 'extra_task_slot' ||
  isArtifactSlotTalent;

// –ø–æ–¥–ø–∏—Å—å –±–æ–Ω—É—Å–∞
const effectValue = (talent.baseValue * 100 * nextLevel).toFixed(0);
const effectLabel =
  talent.effect === 'exp_boost'
    ? `+${effectValue}% EXP`
    : talent.effect === 'gold_boost'
    ? `+${effectValue}% –ó–æ–ª–æ—Ç–∞`
    : talent.effect === 'extra_task_slot'
    ? `+${currentLevel + 1} –°–ª–æ—Ç –∑–∞–¥–∞—á`
    : isArtifactSlotTalent
    ? `+${currentLevel + 1} –°–ª–æ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞`
    : '';

                            return (
                                <PixelCard key={talent.id} className={`${isLocked ? 'opacity-50 grayscale' : ''}`}>
                                    {talent.prereqTalentId && (
                                        <p className="text-[10px] text-red-500 font-bold mb-1">
                                            {isLocked ? 'üîí –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–ª–∞–Ω—Ç' : '‚úîÔ∏è –£—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ'}
                                        </p>
                                    )}
                                    <div className="flex items-center justify-between">
  <div className="flex items-center gap-3">
    <div
      className={
        "text-4xl " +
        (isArtifactSlotTalent ? "text-blue-400" : "text-purple-400")
      }
    >
      {isArtifactSlotTalent ? "üßø" : "‚ú®"}
    </div>
    <div>
      <h3 className="font-bold text-gray-200">
        {talent.name}{" "}
        <span className="text-xs text-gray-500">
          –£—Ä. {currentLevel} / {talent.maxLevel}
        </span>
        {isArtifactSlotTalent && (
          <span className="ml-2 text-[10px] px-1.5 py-0.5 rounded bg-blue-900/40 border border-blue-500/60 text-blue-200 uppercase">
            –°–õ–û–¢–´+
          </span>
        )}
      </h3>

      <p className="text-xs text-gray-400">{description}</p>

      {isArtifactSlotTalent && (
        <p className="text-[10px] text-blue-300 mt-1">
          –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ—Ç—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ –≤ –ò–Ω–≤–µ–Ω—Ç–∞—Ä–µ. –≠—Ñ—Ñ–µ–∫—Ç
          —Å—É–º–º–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–¥–ø–∏—Å–∫–æ–π –∏ Premium Pass, –∞ –≤{" "}
          <span className="font-semibold text-yellow-300">Pro</span> –æ—â—É—â–∞–µ—Ç—Å—è
          –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ.
        </p>
      )}

      {!isArtifactSlotTalent && isSubscriptionSynergyTalent && (
  <p className="text-[10px] text-indigo-300 mt-1">
    –≠—Ç–æ—Ç —Ç–∞–ª–∞–Ω—Ç —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–æ–π{" "}
    <span className="font-semibold text-yellow-300">Pro</span>:
    –±–æ–ª—å—à–µ —Å–ª–æ—Ç–æ–≤, –∑–æ–ª–æ—Ç–∞ –∏ –æ–ø—ã—Ç–∞ –∑–∞ –∑–∞–¥–∞—á–∏.
  </p>
)}

      {currentLevel > 0 && (
        <p className="text-xs font-bold text-emerald-400 mt-1">
          –¢–µ–∫—É—â–∏–π –±–æ–Ω—É—Å: {effectLabel}
        </p>
      )}
    </div>
  </div>
</div>
                                    
                                    <div className="mt-4 pt-4 border-t border-gray-800">
                                        {isMaxLevel ? (
                                            <div className="text-center text-emerald-400 text-sm font-bold p-2 bg-emerald-900/10 rounded">
                                                –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô –£–†–û–í–ï–ù–¨
                                            </div>
                                        ) : (
                                            <Button
                                                onClick={() => onUnlock(talent.id, currentLevel)}
                                                variant={canAfford ? 'primary' : 'secondary'}
                                                disabled={isLocked || !canAfford}
                                                className="w-full"
                                            >
                                                {canAfford ? `–ò–ó–£–ß–ò–¢–¨ ( ${nextCost} ü™ô)` : `–ù–£–ñ–ù–û ${nextCost} ü™ô`}
                                            </Button>
                                        )}
                                    </div>
                                </PixelCard>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const InventoryView = ({ artifacts, equippedIds, maxEquipSlots = 3, onToggleEquip, onBack }) => {
            const equippedArtifacts = artifacts.filter(a => equippedIds.includes(a.id));
            const inventoryArtifacts = artifacts.filter(a => !equippedIds.includes(a.id));

            return (
                <div className="space-y-6 animate-in slide-in-from-right-8 duration-300">
                    <button onClick={onBack} className="text-xs text-gray-400 hover:text-white flex items-center gap-1 mb-2">
                        <Home size={12}/> –í–ï–†–ù–£–¢–¨–°–Ø –í –î–ï–†–ï–í–ù–Æ
                    </button>
                    <h2 className="text-xl font-bold text-white mb-4 border-b border-gray-800 pb-2 flex items-center gap-2">
                        <Pocket size={24} className="text-blue-400"/> –ò–ù–í–ï–ù–¢–ê–†–¨
                    </h2>

                    <PixelCard className="border-blue-500/30 bg-blue-900/10">
                        <h3 className="text-sm font-bold text-blue-400 uppercase tracking-widest mb-3">–≠–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–æ ( {equippedIds.length} / {maxEquipSlots} )</h3>
                        <div className="grid grid-cols-3 gap-3">
                            {Array.from({ length: maxEquipSlots }).map((_, index) => {
                                const artifact = equippedArtifacts[index];
                                return (
                                    <div 
                                        key={index}
                                        className={`
                                            flex flex-col items-center justify-center p-2 rounded-lg h-24 text-center
                                            ${artifact ? 'bg-gray-800 border-2 border-yellow-500 shadow-xl cursor-pointer' : 'bg-gray-900 border border-gray-700 opacity-50'}
                                        `}
                                        onClick={() => artifact && onToggleEquip(artifact)}
                                    >
                                        {artifact ? (
                                            <>
                                                <span className="text-3xl">{artifact.visual}</span>
                                                <span className="text-[10px] font-bold text-yellow-400 mt-1">{artifact.name}</span>
                                                <span className="text-[8px] text-gray-500">–°–Ω—è—Ç—å</span>
                                            </>
                                        ) : (
                                            <span className="text-xs text-gray-600">–°–ª–æ—Ç {index + 1}</span>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </PixelCard>

                    <h3 className="text-xs uppercase tracking-widest text-gray-500 font-bold ml-1 pt-4">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã ({inventoryArtifacts.length})</h3>
                    <div className="space-y-3">
                        {inventoryArtifacts.length === 0 ? (
                            <PixelCard className="text-center text-gray-500">
                                –¢–≤–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç. –ü–æ–≤—ã—à–∞–π –£—Ä–æ–≤–µ–Ω—å, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã!
                            </PixelCard>
                        ) : (
                            inventoryArtifacts.map(artifact => (
                                <PixelCard key={artifact.id} className="flex justify-between items-center group">
                                    <div className="flex items-center gap-3">
                                        <div className="text-3xl">{artifact.visual}</div>
                                        <div>
                                            <h4 className="font-bold text-gray-200">{artifact.name}</h4>
                                            <p className="text-xs text-gray-500">{artifact.description}</p>
                                        </div>
                                    </div>
                                    <Button 
                                        onClick={() => onToggleEquip(artifact)} 
                                        variant="primary" 
                                        className="opacity-80 group-hover:opacity-100"
                                    >
                                        –≠–ö–ò–ü–ò–†–û–í–ê–¢–¨
                                    </Button>
                                </PixelCard>
                            ))
                        )}
                    </div>
                </div>
            );
        };

        const ShopView = ({ upgrades, onUpgrade, currentGold, buildingTaskSlots, subscriptionTier, onBuyBuilding, onBack }) => {
            return (
                <div className="space-y-6 animate-in slide-in-from-right-8 duration-300">
                    <button onClick={onBack} className="text-xs text-gray-400 hover:text-white flex items-center gap-1 mb-2">
                        <Home size={12}/> –í–ï–†–ù–£–¢–¨–°–Ø –í –î–ï–†–ï–í–ù–Æ
                    </button>

                    <h2 className="text-xl font-bold text-white mb-4 border-b border-gray-800 pb-2">–ú–∞–≥–∞–∑–∏–Ω –£–ª—É—á—à–µ–Ω–∏–π</h2>
                    <PixelCard className="bg-gray-900 border-yellow-500/30">
                        <div className="flex items-center justify-between">
                            <span className="text-sm text-gray-400">–¢–≤–æ–µ –ó–æ–ª–æ—Ç–æ:</span>
                            <span className="text-2xl font-bold text-yellow-400 flex items-center gap-2">
                                {currentGold} ü™ô
                            </span>
                        </div>
                    </PixelCard>
                    
                    <div className="space-y-4">
                        {UPGRADES.map((upgradeSet) => {
                            const currentLevel = upgrades[upgradeSet.locationId] || 1;
                            const currentStep = getCurrentUpgrade(upgradeSet.locationId, currentLevel);
                            const nextStep = getNextUpgrade(upgradeSet.locationId, currentLevel);
                            
                            if (!currentStep) return null;

                            return (
                                <PixelCard key={upgradeSet.locationId} className="border-gray-700">
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center gap-4">
                                            <div className="text-4xl">{currentStep.visual}</div>
                                            <div>
                                                <h3 className="font-bold text-gray-200">{upgradeSet.name}</h3>
                                                <p className="text-xs text-gray-500">
                                                    –¢–µ–∫—É—â–∏–π –£—Ä–æ–≤–µ–Ω—å: <span className="text-yellow-400 font-bold">{currentStep.level}</span> ({currentStep.name})
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="mt-4 pt-4 border-t border-gray-800">
                                        {nextStep ? (() => {
                                            const subBonuses = getSubscriptionBonuses(subscriptionTier || 'basic');
                                            const discount = (subscriptionTier === 'advanced' || subscriptionTier === 'pro')
                                              ? (1 - 1 / subBonuses.goldMultiplier)   // –Ω–µ–±–æ–ª—å—à–∞—è –≤–∏–∑—É–∞–ª—å–Ω–æ –ª–æ–≥–∏—á–Ω–∞—è —Å–∫–∏–¥–∫–∞
                                              : 0;

                                            const finalCost = Math.round(nextStep.cost * (1 - discount));
                                            const canBuy = currentGold >= finalCost;

                                            return (
                                              <div className="flex justify-between items-center">
                                                <div className="text-xs text-gray-400 leading-tight max-w-[60%]">
                                                  –°–ª–µ–¥. –£—Ä–æ–≤–µ–Ω—å (<span className="text-white">{nextStep.level}</span>): {nextStep.name}
                                                  {discount > 0 && (
                                                    <div className="text-[10px] text-emerald-300 mt-1">
                                                      –°–∫–∏–¥–∫–∞ –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ: ‚àí{Math.round(discount * 100)}%
                                                    </div>
                                                  )}
                                                </div>
                                                <Button 
                                                  onClick={() => onUpgrade(upgradeSet.locationId, finalCost)}
                                                  variant={canBuy ? 'primary' : 'secondary'}
                                                  disabled={!canBuy}
                                                >
                                                  {canBuy
                                                    ? `–ö–£–ü–ò–¢–¨ (${finalCost} ü™ô)`
                                                    : `–ù–£–ñ–ù–û ${finalCost} ü™ô`}
                                                </Button>
                                              </div>
                                            );
                                        })() : (
                                            <div className="text-center text-emerald-400 text-sm font-bold p-2 bg-emerald-900/10 rounded">
                                                –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô –£–†–û–í–ï–ù–¨
                                            </div>
                                        )}
                                    </div>
                                </PixelCard>
                            );
                        })}
                    </div>

<PixelCard className="mt-4 border-indigo-500/40 bg-indigo-900/10">
  <div className="flex items-start justify-between gap-3">
    <div>
      <h3 className="font-bold text-gray-200">–ù–æ–≤—ã–µ –ó–¥–∞–Ω–∏—è TVA</h3>
      <p className="text-xs text-gray-400 mt-1">
        –ö–∞–∂–¥–æ–µ –Ω–æ–≤–æ–µ –∑–¥–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç +1 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ
        –¥–ª—è –≤—Å–µ–π –¥–µ—Ä–µ–≤–Ω–∏.
      </p>
      <p className="text-[11px] text-indigo-300 mt-2">
        –°–µ–π—á–∞—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ: <span className="font-bold">{buildingTaskSlots || 0}</span>
      </p>
    </div>

    {(() => {
      const maxBuildings = 5;
      const currentBuildings = buildingTaskSlots || 0;
      const nextCost = 1500 * (currentBuildings + 1);
      const canBuy = currentBuildings < maxBuildings && currentGold >= nextCost;

      if (currentBuildings >= maxBuildings) {
        return (
          <div className="text-[10px] text-emerald-400 font-bold text-right">
            –ú–ê–ö–°. –£–†–û–í–ï–ù–¨<br/>–í–°–ï –ó–î–ê–ù–ò–Ø –ü–û–°–¢–†–û–ï–ù–´
          </div>
        );
      }

      return (
        <Button
          onClick={onBuyBuilding}
          variant={canBuy ? "accent" : "secondary"}
          disabled={!canBuy}
          className="whitespace-nowrap"
        >
          {canBuy ? `–ü–û–°–¢–†–û–ò–¢–¨ (${nextCost} ü™ô)` : `–ù–£–ñ–ù–û ${nextCost} ü™ô`}
        </Button>
      );
    })()}
  </div>
</PixelCard>

                </div>
            );
        };

        const getSkillData = (stats) => {
  // –°—É–º–º–∏—Ä—É–µ–º –∑–∞–¥–∞—á–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∑–∞ –≤—Å–µ –¥–Ω–∏
  const totals = stats.reduce(
    (acc, day) => {
      acc.sleep    += day.sleepTasks    || 0;
      acc.sport    += day.sportTasks    || 0;
      acc.charts   += day.chartTasks    || 0;
      acc.learning += day.learningTasks || 0;
      acc.research += (day.researchTasks || 0) + (day.planningTasks || 0); // —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Å—á–∏—Ç–∞–µ–º –∫–∞–∫ research+planning
      return acc;
    },
    { sleep: 0, sport: 0, charts: 0, learning: 0, research: 0 }
  );

  const values = Object.values(totals);
  const maxValue = Math.max(...values, 1); // —á—Ç–æ–± fullMark –Ω–µ –±—ã–ª 0

  return [
    { label: '–°–æ–Ω',       value: totals.sleep,    fullMark: maxValue },
    { label: '–°–ø–æ—Ä—Ç',     value: totals.sport,    fullMark: maxValue },
    { label: '–ì—Ä–∞—Ñ–∏–∫–∏',   value: totals.charts,   fullMark: maxValue },
    { label: '–ó–Ω–∞–Ω–∏—è',    value: totals.learning, fullMark: maxValue },
    { label: '–°—Ç—Ä–∞—Ç–µ–≥–∏—è', value: totals.research, fullMark: maxValue },
  ];
};

        const getRecommendations = (profile, statsHistory) => {
            return ["üåü –¢–≤–æ—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –±–µ–∑—É–ø—Ä–µ—á–Ω–∞, –¢—Ä–µ–π–¥–µ—Ä. –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ."];
        };

        const StatsView = ({ stats, profile, subscriptionTier, hasPremiumPass, onBack }) => {
  if (!profile) return null;

  const isBasic = subscriptionTier === 'basic';
  const isAdvanced = subscriptionTier === 'advanced';
  const isPro = subscriptionTier === 'pro';

  // –µ—Å—Ç—å –ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
  const hasAdvancedAnalytics = isAdvanced || isPro;
  // –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è (7 –¥–Ω–µ–π) ‚Äî —Ç–æ–ª—å–∫–æ Pro
  const hasFullHistory = isPro;

  return (
                <div className="space-y-6 animate-in slide-in-from-right-8 duration-300">
                    <button onClick={onBack} className="text-xs text-gray-400 hover:text-white flex items-center gap-1 mb-2">
                       <Home size={12}/> –í–ï–†–ù–£–¢–¨–°–Ø –í –î–ï–†–ï–í–ù–Æ
                    </button>

                    <h2 className="text-xl font-bold text-white mb-4 border-b border-gray-800 pb-2">–ü—Ä–æ–≥—Ä–µ—Å—Å –¢—Ä–µ–π–¥–µ—Ä–∞</h2>

                    <PixelCard className="flex flex-col items-center justify-center pt-8 pb-4">
                      <h3 className="text-xs uppercase tracking-widest text-gray-500 font-bold mb-4">–ö–æ–ª–µ—Å–æ –ù–∞–≤—ã–∫–æ–≤</h3>
                      <RadarChart data={getSkillData(stats)} />
                      <p className="text-[10px] text-gray-500 mt-4 text-center max-w-xs">
                        –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –≤ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è.
                      </p>
                    </PixelCard>

                    {hasAdvancedAnalytics ? (
  // üîì –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è Advanced / Pro
  <PixelCard className="border-indigo-500/30 bg-indigo-900/10">
    <div className="flex items-center gap-2 mb-3 text-indigo-400">
      <Target size={18} />
      <h3 className="font-bold text-sm uppercase">–°–æ–≤–µ—Ç—ã –ú–µ–Ω—Ç–æ—Ä–∞</h3>
    </div>
    <ul className="space-y-2">
      {getRecommendations(profile, stats).map((rec, idx) => (
        <li
          key={idx}
          className="text-xs text-gray-300 flex items-start gap-2 bg-black/20 p-2 rounded"
        >
          <span className="mt-0.5 text-indigo-500">‚û§</span> {rec}
        </li>
      ))}
    </ul>
  </PixelCard>
) : (
  // üîí –¢–∏–∑–µ—Ä –¥–ª—è –±–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏
  <PixelCard className="border-gray-800 bg-black/40">
    <div className="flex items-center gap-2 mb-2 text-gray-400">
      <Lock size={16} className="text-gray-500" />
      <h3 className="font-bold text-sm uppercase">–°–æ–≤–µ—Ç—ã –ú–µ–Ω—Ç–æ—Ä–∞</h3>
    </div>
    <p className="text-xs text-gray-500 mb-2">
      –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–≤ TVA –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –ø–æ–¥–ø–∏—Å–∫–µ{' '}
      <span className="text-indigo-300 font-semibold">Advanced</span> –∏{' '}
      <span className="text-yellow-300 font-semibold">Pro</span>.
    </p>
    <p className="text-[10px] text-gray-600">
      –û—Ç–∫—Ä–æ–π —ç–∫—Ä–∞–Ω <span className="text-yellow-400 font-semibold">Premium Pass</span> –≤ –¥–µ—Ä–µ–≤–Ω–µ, —á—Ç–æ–±—ã
      –≤—ã–±—Ä–∞—Ç—å —Ç–∞—Ä–∏—Ñ –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É.
    </p>
  </PixelCard>
)}

                    <div className="space-y-2">
  <h3 className="text-xs uppercase tracking-widest text-gray-500 font-bold ml-1">
    {hasFullHistory ? '–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π' : '–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏ (DEMO)'}
  </h3>

  {(() => {
    const reversed = stats.slice().reverse();
    const limit = hasFullHistory ? 7 : 3;
    const visibleStats = reversed.slice(0, limit);

    return (
      <>
        {visibleStats.map((stat) => (
          <div
            key={stat.date}
            className="flex items-center justify-between p-3 bg-[#151a25] rounded border border-[#2a3441] text-xs"
          >
            <span className="text-gray-400">{stat.date}</span>
            <div className="flex gap-4">
              <span className="text-emerald-400">{stat.tasksCompleted} –ó–∞–¥–∞—á</span>
              <span className="text-yellow-400">+{stat.expGained} EXP</span>
            </div>
          </div>
        ))}

        {stats.length === 0 && (
          <div className="text-center text-gray-600 text-xs py-4">
            –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞—á–∏!
          </div>
        )}

        {!hasFullHistory && stats.length > 0 && (
          <p className="text-[10px] text-gray-600 mt-1">
            –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∑–∞ 7 –¥–Ω–µ–π –∏ –±–æ–ª–µ–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ø–æ–¥–ø–∏—Å–∫–µ{' '}
            <span className="text-yellow-300 font-semibold">Pro</span>.
          </p>
        )}
      </>
    );
  })()}
</div>
                </div>
            );
        };

        const PROFILE_EDIT_COST = 500;

const ProfileEditView = ({ profile, playerGold, onSave, onBack }) => {
  const [name, setName] = React.useState(profile.name || '');
  const [goal, setGoal] = React.useState(profile.goal || 'beginner');
  const [sleepTime, setSleepTime] = React.useState(profile.sleepTimeTarget || '23:00');
  const [wakeTime, setWakeTime] = React.useState(profile.wakeTimeTarget || '07:00');
  const [sportPerDay, setSportPerDay] = React.useState(profile.sportPerDayTarget || 30);

  const hasChanges =
    name !== profile.name ||
    goal !== profile.goal ||
    sleepTime !== profile.sleepTimeTarget ||
    wakeTime !== profile.wakeTimeTarget ||
    sportPerDay !== profile.sportPerDayTarget;

  const canAfford = playerGold >= PROFILE_EDIT_COST;

  const handleSaveClick = () => {
    if (!hasChanges) return;
    onSave(
      {
        ...profile,
        name,
        goal,
        sleepTimeTarget: sleepTime,
        wakeTimeTarget: wakeTime,
        sportPerDayTarget: sportPerDay,
      },
      PROFILE_EDIT_COST
    );
  };

  return (
    <div className="space-y-6 animate-in slide-in-from-right-8 duration-300">
      <button
        onClick={onBack}
        className="text-xs text-gray-400 hover:text-white flex items-center gap-1 mb-2"
      >
        <Home size={12} /> –í–ï–†–ù–£–¢–¨–°–Ø –í –î–ï–†–ï–í–ù–Æ
      </button>

      <h2 className="text-xl font-bold text-white mb-4 border-b border-gray-800 pb-2">
        –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü—Ä–æ—Ñ–∏–ª—è
      </h2>

      <PixelCard className="bg-gray-900 border-yellow-500/30">
        <div className="flex items-center justify-between mb-2">
          <span className="text-sm text-gray-400">–¢–≤–æ—ë –∑–æ–ª–æ—Ç–æ:</span>
          <span className="text-lg font-bold text-yellow-400 flex items-center gap-1">
            {playerGold} ü™ô
          </span>
        </div>
        <p className="text-[11px] text-gray-400">
          –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Å–ø–∏—Å—ã–≤–∞–µ—Ç{' '}
          <span className="text-yellow-400 font-bold">{PROFILE_EDIT_COST} ü™ô</span>.
        </p>
      </PixelCard>

      <PixelCard className="space-y-4">
        <div>
          <label className="block text-xs uppercase text-gray-500 font-bold mb-1">
            –ò–º—è –¢—Ä–µ–π–¥–µ—Ä–∞
          </label>
          <input
            type="text"
            value={name}
            onChange={(e) => setName(e.target.value)}
            className="w-full bg-gray-900 border border-gray-700 text-white p-2 rounded focus:border-yellow-500 outline-none"
          />
        </div>

        <div>
          <label className="block text-xs uppercase text-gray-500 font-bold mb-1">
            –¶–µ–ª—å / –†–æ–ª—å
          </label>
          <div className="grid grid-cols-3 gap-2">
            {[
              { id: 'beginner', label: '–ù–æ–≤–∏—á–æ–∫' },
              { id: 'advanced', label: '–û–ø—ã—Ç–Ω—ã–π' },
              { id: 'pro', label: '–ü—Ä–æ—Ñ–∏' },
            ].map((g) => (
              <button
                key={g.id}
                onClick={() => setGoal(g.id)}
                className={`p-2 text-xs uppercase font-bold border rounded transition-colors ${
                  goal === g.id
                    ? 'bg-yellow-600 border-yellow-500 text-white'
                    : 'bg-gray-800 border-gray-700 text-gray-400'
                }`}
              >
                {g.label}
              </button>
            ))}
          </div>
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-xs uppercase text-gray-500 font-bold mb-1">
              –û—Ç–±–æ–π
            </label>
            <input
              type="time"
              value={sleepTime}
              onChange={(e) => setSleepTime(e.target.value)}
              className="w-full bg-gray-900 border border-gray-700 text-white p-2 rounded"
            />
          </div>
          <div>
            <label className="block text-xs uppercase text-gray-500 font-bold mb-1">
              –ü–æ–¥—ä—ë–º
            </label>
            <input
              type="time"
              value={wakeTime}
              onChange={(e) => setWakeTime(e.target.value)}
              className="w-full bg-gray-900 border border-gray-700 text-white p-2 rounded"
            />
          </div>
        </div>

        <div>
          <label className="block text-xs uppercase text-gray-500 font-bold mb-1">
            –°–ø–æ—Ä—Ç (–º–∏–Ω/–¥–µ–Ω—å)
          </label>
          <input
            type="number"
            value={sportPerDay}
            onChange={(e) => setSportPerDay(parseInt(e.target.value) || 0)}
            className="w-full bg-gray-900 border border-gray-700 text-white p-2 rounded"
          />
        </div>
      </PixelCard>

      <Button
        onClick={handleSaveClick}
        variant={hasChanges && canAfford ? 'accent' : 'secondary'}
        disabled={!hasChanges || !canAfford}
        className="w-full py-3"
      >
        {hasChanges
          ? canAfford
            ? `–°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø (‚àí${PROFILE_EDIT_COST} ü™ô)`
            : `–ù–£–ñ–ù–û ${PROFILE_EDIT_COST} ü™ô`
          : '–ò–ó–ú–ï–ù–ï–ù–ò–ô –ù–ï–¢'}
      </Button>
    </div>
  );
};

        const RoadmapView = ({ onBack }) => {
  return (
    <div className="space-y-6 animate-in slide-in-from-right-8 duration-300">
      {/* –ö–Ω–æ–ø–∫–∞ "–Ω–∞–∑–∞–¥" */}
      <button
        onClick={onBack}
        className="text-xs text-gray-400 hover:text-white flex items-center gap-1 mb-2"
      >
        <Home size={12} />
        –í–ï–†–ù–£–¢–¨–°–Ø –í –î–ï–†–ï–í–ù–Æ
      </button>

      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫—Ä–∞—Ç–∫–∏–π –ø–∏—Ç—á */}
      <PixelCard className="border-yellow-500/30 bg-gradient-to-r from-gray-900 to-gray-800">
        <h2 className="text-xl font-bold text-yellow-400 mb-2">
          TVA Ecosystem Roadmap
        </h2>
        <p className="text-xs text-gray-400">
          –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è Trading Village Academy: –æ—Ç –ª–∏—á–Ω–æ–≥–æ —Ç—Ä–µ–∫–µ—Ä–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã
          –¥–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –≥–µ–π–º–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è —Ç—Ä–µ–π–¥–µ—Ä–æ–≤.
        </p>
        <span className="inline-block mt-3 text-[10px] uppercase tracking-widest text-yellow-500 bg-yellow-900/20 px-2 py-1 rounded border border-yellow-700/40">
          MVP ‚Üí Social ‚Üí PvP ‚Üí Web3
        </span>
      </PixelCard>

      {/* Q1 ‚Äî Foundation */}
      <PixelCard className="border-gray-700">
        <h3 className="text-lg font-bold text-white mb-3">Q1 ‚Äî Foundation</h3>
        <ul className="text-sm text-gray-300 space-y-2">
          <li>‚Ä¢ –û–Ω–ª–∞–π–Ω-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</li>
          <li>‚Ä¢ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–∏–≤—ã—á–µ–∫</li>
          <li>‚Ä¢ –£—Ä–æ–≤–Ω–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–µ—Ä–µ–≤–Ω–∏ –∏ –∞–ø–≥—Ä–µ–π–¥—ã –∑–¥–∞–Ω–∏–π</li>
          <li>‚Ä¢ –ü–µ—Ä–≤—ã–π –Ω–∞–±–æ—Ä –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏ —Ç–∞–ª–∞–Ω—Ç–æ–≤</li>
        </ul>
      </PixelCard>

      {/* Q2 ‚Äî Social Layer */}
      <PixelCard className="border-gray-700">
        <h3 className="text-lg font-bold text-white mb-3">Q2 ‚Äî Social Layer</h3>
        <ul className="text-sm text-gray-300 space-y-2">
          <li>‚Ä¢ –î—Ä—É–∑—å—è –∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ —Ç—Ä–µ–π–¥–µ—Ä–æ–≤</li>
          <li>‚Ä¢ –õ–∏–¥–µ—Ä–±–æ—Ä–¥—ã: –¥–µ–Ω—å / –Ω–µ–¥–µ–ª—è / —Å–µ–∑–æ–Ω</li>
          <li>‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏: –∫–ª–∞–Ω—ã / –¥–µ—Ä–µ–≤–Ω–∏-—Å–æ—é–∑—ã</li>
          <li>‚Ä¢ –°—Ç–∞—Ç—É—Å–Ω—ã–µ —Ä–æ–ª–∏ –∏ ¬´—Ç–∏—Ç—É–ª—ã¬ª –≤–Ω—É—Ç—Ä–∏ –¥–µ—Ä–µ–≤–Ω–∏</li>
        </ul>
      </PixelCard>

      {/* Q3 ‚Äî PvP / –ú–µ—Ç–∞–≥–µ–π–º */}
      <PixelCard className="border-gray-700">
        <h3 className="text-lg font-bold text-white mb-3">
          Q3 ‚Äî PvP & Meta Progression
        </h3>
        <ul className="text-sm text-gray-300 space-y-2">
          <li>‚Ä¢ PvP-¬´–¥—É—ç–ª–∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã¬ª –º–µ–∂–¥—É —Ç—Ä–µ–π–¥–µ—Ä–∞–º–∏</li>
          <li>‚Ä¢ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –±–æ—Å—Å—ã –∏ –∫–æ–º–∞–Ω–¥–Ω—ã–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è</li>
          <li>‚Ä¢ –°–µ–∑–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏ –∏ —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏</li>
          <li>‚Ä¢ –ì–ª—É–±–∂–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–µ—Ä–µ–≤–Ω–∏ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</li>
        </ul>
      </PixelCard>

      {/* Q4 ‚Äî Web3 / NFT / Token (–µ—Å–ª–∏ –±—É–¥–µ—Ç–µ –¥–µ–ª–∞—Ç—å) */}
      <PixelCard className="border-gray-700">
        <h3 className="text-lg font-bold text-white mb-3">Q4 ‚Äî Web3 Layer</h3>
        <ul className="text-sm text-gray-300 space-y-2">
          <li>‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –∏ –∑–¥–∞–Ω–∏—è –∫–∞–∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ / NFT-—Å–∫–∏–Ω—ã</li>
          <li>‚Ä¢ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∫–∞–∫ on-chain –æ–±—ä–µ–∫—Ç—ã</li>
          <li>‚Ä¢ TVA Token –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —ç–∫–æ–Ω–æ–º–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</li>
          <li>‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω—ã–π ¬´—Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π¬ª —Å–ª–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã</li>
        </ul>
      </PixelCard>

      {/* Vision-–±–ª–æ–∫ –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞ */}
      <PixelCard className="border-yellow-700/30 bg-yellow-900/5">
        <h3 className="text-lg font-bold text-yellow-400 mb-2">
          Vision: ¬´Duolingo –¥–ª—è —Ç—Ä–µ–π–¥–µ—Ä–æ–≤¬ª
        </h3>
        <p className="text-sm text-gray-300 leading-relaxed">
          TVA ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫. –≠—Ç–æ –≥–µ–π–º–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–∫–∞–¥–µ–º–∏—è,
          –≥–¥–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, –æ–±—É—á–µ–Ω–∏–µ –∏ —Ç–æ—Ä–≥–æ–≤–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ –µ–¥–∏–Ω—ã–π
          –∏–≥—Ä–æ–≤–æ–π –æ–ø—ã—Ç —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–µ–π, —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º–∏ –º–µ—Ö–∞–Ω–∏–∫–∞–º–∏ –∏ –±—É–¥—É—â–∏–º
          Web3-—Å–ª–æ–µ–º.
        </p>
      </PixelCard>
    </div>
  );
};

const PremiumView = ({ onBack, hasPremiumPass, subscriptionTier, onActivatePremium, onSetSubscriptionTier }) => {
  const isBasic = subscriptionTier === 'basic';
  const isAdvanced = subscriptionTier === 'advanced';
  const isPro = subscriptionTier === 'pro';

  return (
    <div className="space-y-6 animate-in slide-in-from-right-8 duration-300">
      {/* –ö–Ω–æ–ø–∫–∞ "–Ω–∞–∑–∞–¥" */}
      <button
        onClick={onBack}
        className="text-xs text-gray-400 hover:text-white flex items-center gap-1 mb-2"
      >
        <Home size={12} />
        –í–ï–†–ù–£–¢–¨–°–Ø –í –î–ï–†–ï–í–ù–Æ
      </button>

      {/* HERO-–±–ª–æ–∫ */}
      <PixelCard className="border-yellow-500/40 bg-gradient-to-r from-gray-900 to-gray-800">
        <div className="flex items-start gap-4">
          <div className="p-3 bg-yellow-500/10 rounded-full border border-yellow-400/60">
            <Crown size={32} className="text-yellow-400" />
          </div>
          <div className="space-y-2">
            <h2 className="text-xl font-bold text-yellow-400">
              TVA Premium Pass
            </h2>
            <p className="text-xs text-gray-300">
              –†–∞–∑–±–ª–æ–∫–∏—Ä—É–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–∏, –±—É—Å—Ç–µ—Ä—ã EXP, —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ
              –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ VIP-–∏—Å–ø—ã—Ç–∞–Ω–∏—è. Premium ‚Äî —ç—Ç–æ —É—Å–∫–æ—Ä–∏—Ç–µ–ª—å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã,
              –∞ –Ω–µ pay-to-win.
            </p>
            <div className="flex flex-wrap gap-2 text-[10px]">
              <span className="px-2 py-1 rounded bg-yellow-500/10 border border-yellow-600/40 text-yellow-300 font-bold uppercase tracking-widest">
                +3 —Å–ª–æ—Ç–∞ –∑–∞–¥–∞—á
              </span>
              <span className="px-2 py-1 rounded bg-emerald-500/10 border border-emerald-600/40 text-emerald-300 font-bold uppercase tracking-widest">
                VIP Weekly Boss
              </span>
              <span className="px-2 py-1 rounded bg-purple-500/10 border border-purple-600/40 text-purple-300 font-bold uppercase tracking-widest">
                –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
              </span>
            </div>
          </div>
        </div>

         <div className="mt-4">
          <Button
            variant={hasPremiumPass ? "secondary" : "accent"}
            className="w-full py-3"
            onClick={hasPremiumPass ? undefined : onActivatePremium}
            disabled={hasPremiumPass}
          >
            {hasPremiumPass
              ? "PREMIUM –£–ñ–ï –ê–ö–¢–ò–í–ï–ù"
              : "–ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨ PREMIUM PASS"}
          </Button>

          <p className="text-[10px] text-gray-500 mt-2 text-center">
            –°–µ–π—á–∞—Å –∞–∫—Ç–∏–≤–∞—Ü–∏—è Premium Pass –≤–∫–ª—é—á–∞–µ—Ç –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏–≥—Ä–æ–∫–∞
            (–¥–µ–º–æ-—Ä–µ–∂–∏–º). –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã –∏ –±–∏–ª–ª–∏–Ω–≥–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞ —ç—Ç–∞–ø–µ
            –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –±—ç–∫–µ–Ω–¥–∞ / —Å—Ç–æ—Ä–∞.
          </p>
        </div>
      </PixelCard>

      {/* –ë–ª–æ–∫: —á—Ç–æ –¥–∞—ë—Ç Premium Pass */}
      <PixelCard className="border-gray-700 bg-gray-900/60">
        <div className="flex items-center gap-2 mb-3">
          <Shield size={18} className="text-emerald-400" />
          <h3 className="text-sm font-bold text-white uppercase tracking-widest">
            –ß—Ç–æ –¥–∞—ë—Ç Premium Pass
          </h3>
        </div>

        <ul className="text-xs text-gray-300 space-y-2">
          <li>
            ‚Ä¢ <span className="text-yellow-300 font-semibold">+3 –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö —Å–ª–æ—Ç–∞ –∑–∞–¥–∞—á</span>{' '}
            ‚Äî –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–æ–∫–∞—á–∏–≤–∞–µ—à—å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É –∏ —É—Ä–æ–≤–µ–Ω—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.
          </li>
          <li>
            ‚Ä¢ <span className="text-yellow-300 font-semibold">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–∏</span>:
            –î–≤–æ—Ä–µ—Ü –°—Ç—Ä–∞—Ç–µ–≥–æ–≤, –ó–∞–ª –ú–∞—Å—Ç–µ—Ä–æ–≤ –ì—Ä–∞—Ñ–∏–∫–æ–≤, –î–æ–º –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π
            –û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏.
          </li>
          <li>
            ‚Ä¢ <span className="text-yellow-300 font-semibold">–í—Ä–µ–º–µ–Ω–Ω—ã–µ –±—É—Å—Ç–µ—Ä—ã EXP</span> ‚Äî
            x1.2 / x1.5 / x2 –Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.
          </li>
          <li>
            ‚Ä¢ <span className="text-yellow-300 font-semibold">–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã</span>:
            –ö–æ—Ä–æ–Ω–∞ –î–∏—Å—Ü–∏–ø–ª–∏–Ω—ã, –ö–∞–º–µ–Ω—å –°–ø–æ–∫–æ–π—Å—Ç–≤–∏—è, –°–≤–∏—Ç–æ–∫ –ü—Ä–æ–∑–æ—Ä–ª–∏–≤–æ—Å—Ç–∏.
          </li>
          <li>
            ‚Ä¢ <span className="text-yellow-300 font-semibold">VIP Weekly Boss</span> —Å
            —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º–∏ –Ω–∞–≥—Ä–∞–¥–∞–º–∏ –∏ —à–∞–Ω—Å–æ–º —Ä–µ–¥–∫–æ–≥–æ –¥—Ä–æ–ø–∞.
          </li>
          <li>
            ‚Ä¢ <span className="text-yellow-300 font-semibold">Premium-–±–µ–π–¥–∂</span> –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏
            –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –≤–Ω—É—Ç—Ä–∏ –¥–µ—Ä–µ–≤–Ω–∏.
          </li>
        </ul>
      </PixelCard>

      {/* –ë–ª–æ–∫: –ü–æ–¥–ø–∏—Å–∫–∏ TVA */}
      <PixelCard className="border-indigo-500/40 bg-indigo-900/10">
        <div className="flex items-center gap-2 mb-3">
          <CreditCard size={18} className="text-indigo-300" />
          <h3 className="text-sm font-bold text-white uppercase tracking-widest">
            –ü–æ–¥–ø–∏—Å–∫–∏ TVA (Recurring –º–æ–¥–µ–ª—å)
          </h3>
        </div>

    
          {/* Basic */}
          <div
            className={
              "p-3 rounded border " +
              (isBasic
                ? "bg-gray-900 border-emerald-400 shadow-lg"
                : "bg-gray-900/80 border-gray-700")
            }
          >
            <div className="flex justify-between items-center mb-1">
              <span className="text-sm font-bold text-gray-100">
                Basic
              </span>
              <span className="text-xs font-bold text-emerald-300">
                $4.99 / –º–µ—Å—è—Ü
              </span>
            </div>
            <p className="text-[11px] text-gray-400 mb-1">
              –û–±–ª–∞–∫–æ, extended-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.
            </p>
            <ul className="text-[10px] text-gray-300 space-y-1 mb-2">
              <li>‚Ä¢ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ –æ–±–ª–∞–∫–µ</li>
              <li>‚Ä¢ –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–∏–≤—ã—á–µ–∫</li>
              <li>‚Ä¢ –ë–∞–∑–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã —Ç—Ä–µ–π–¥–µ—Ä–∞</li>
            </ul>
            <Button
              variant={isBasic ? "success" : "primary"}
              className="w-full py-1.5 text-[11px]"
              onClick={() => onSetSubscriptionTier('basic')}
            >
              {isBasic ? "–¢–ê–†–ò–§ BASIC –ê–ö–¢–ò–í–ï–ù" : "–í–´–ë–†–ê–¢–¨ BASIC"}
            </Button>
          </div>

           {/* Advanced */}
          <div
            className={
              "p-3 rounded border " +
              (isAdvanced
                ? "bg-gray-900 border-emerald-400 shadow-lg"
                : "bg-gray-900/80 border-indigo-500/60")
            }
          >
            <div className="flex justify-between items-center mb-1">
              <span className="text-sm font-bold text-indigo-200">
                Advanced
              </span>
              <span className="text-xs font-bold text-emerald-300">
                $8.99 / –º–µ—Å—è—Ü
              </span>
            </div>
            <p className="text-[11px] text-gray-400 mb-1">
              –ì–ª—É–±–æ–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –∏ –ø—Ä–∏–≤—ã—á–µ–∫.
            </p>
            <ul className="text-[10px] text-gray-300 space-y-1 mb-2">
              <li>‚Ä¢ Heatmap –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã</li>
              <li>‚Ä¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</li>
              <li>‚Ä¢ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–≤ TVA</li>
            </ul>
            <Button
              variant={isAdvanced ? "success" : "primary"}
              className="w-full py-1.5 text-[11px]"
              onClick={() => onSetSubscriptionTier('advanced')}
            >
              {isAdvanced ? "–¢–ê–†–ò–§ ADVANCED –ê–ö–¢–ò–í–ï–ù" : "–í–´–ë–†–ê–¢–¨ ADVANCED"}
            </Button>
          </div>

          {/* Pro */}
          <div
            className={
              "p-3 rounded border " +
              (isPro
                ? "bg-gray-900 border-emerald-400 shadow-lg"
                : "bg-gray-900/80 border-yellow-500/70")
            }
          >
            <div className="flex justify-between items-center mb-1">
              <span className="text-sm font-bold text-yellow-300 flex items-center gap-1">
                Pro <Star size={14} className="text-yellow-400" />
              </span>
              <span className="text-xs font-bold text-emerald-300">
                $14.99 / –º–µ—Å—è—Ü
              </span>
            </div>
            <p className="text-[11px] text-gray-400 mb-1">
              –î–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –º–∞–∫—Å–∏–º—É–º –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞.
            </p>
            <ul className="text-[10px] text-gray-300 space-y-1 mb-2">
              <li>‚Ä¢ –í—Å—ë –∏–∑ Advanced</li>
              <li>‚Ä¢ VIP Weekly Boss –∏ –ø–æ–≤—ã—à–µ–Ω–Ω—ã–π —à–∞–Ω—Å –¥—Ä–æ–ø–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤</li>
              <li>‚Ä¢ –°–∫–∏–¥–∫–∏ –Ω–∞ –±—É—Å—Ç–µ—Ä—ã –∏ —Å–∫–∏–Ω—ã</li>
              <li>‚Ä¢ –ó–æ–ª–æ—Ç–æ–π —Ñ—Ä–µ–π–º –ø—Ä–æ—Ñ–∏–ª—è –∏ –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</li>
            </ul>
            <Button
              variant={isPro ? "success" : "primary"}
              className="w-full py-1.5 text-[11px]"
              onClick={() => onSetSubscriptionTier('pro')}
            >
              {isPro ? "–¢–ê–†–ò–§ PRO –ê–ö–¢–ò–í–ï–ù" : "–í–´–ë–†–ê–¢–¨ PRO"}
            </Button>
          </div>

        <p className="text-[10px] text-gray-500 mt-2">
          –ù–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞ —Ü–µ–Ω—ã –∏ —É—Å–ª–æ–≤–∏—è —Ñ–∏–∫—Ç–∏–≤–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è
          –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –≤—ã—Ä—É—á–∫–∏ –∏ –º–æ–¥–µ–ª–∏ LTV.
        </p>
      </PixelCard>

      {/* –ë–ª–æ–∫: –°–∫–∏–Ω—ã –∏ –≤–∏–∑—É–∞–ª (–Ω–µ P2W) */}
      <PixelCard className="border-gray-700 bg-gray-900/70">
        <div className="flex items-center gap-2 mb-3">
          <ShoppingBag size={18} className="text-pink-300" />
          <h3 className="text-sm font-bold text-white uppercase tracking-widest">
            –°–∫–∏–Ω—ã –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
          </h3>
        </div>

        <p className="text-xs text-gray-300 mb-2">
          –í—Å—ë, —á—Ç–æ –ø—Ä–æ–¥–∞—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç Premium –∏ –ø–æ–¥–ø–∏—Å–æ–∫, ‚Äî —á–∏—Å—Ç–∞—è
          –∫–æ—Å–º–µ—Ç–∏–∫–∞ –ø–æ–∫–∞ —á—Ç–æ, –Ω–µ —Å—Ç–æ–∏—Ç –±—ã—Ç—å –∫ —ç—Ç–æ–º—É —Å—Ç—Ä–æ–≥–∏–º, –≤–µ–¥—å –º—ã —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ–º.
        </p>

        <ul className="text-[11px] text-gray-300 space-y-1">
          <li>‚Ä¢ –°–∫–∏–Ω—ã –∑–¥–∞–Ω–∏–π: –Ω–µ–æ–Ω–æ–≤—ã–µ –º—ç—Ä–∏–∏, —Ö—Ä–∞–º—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤, –∫–∏–±–µ—Ä-–±–∞–Ω—è.</li>
          <li>‚Ä¢ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –æ–±—Ä–∞–∑—ã –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–≤ (–°—Ç–∞—Ä—ã–π –¢—Ä–µ–π–¥–µ—Ä, –ú–æ–Ω–∞—Ö, –î–µ–¥ –ê–Ω–∞–ª–∏—Ç–∏–∫).</li>
          <li>‚Ä¢ –≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á: –∞—É—Ä—ã, —á–∞—Å—Ç–∏—Ü—ã, ¬´–æ–≥–Ω–µ–Ω–Ω–∞—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞¬ª.</li>
          <li>‚Ä¢ Emotes / —Å—Ç–∏–∫–µ—Ä—ã –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–ª–æ—è.</li>
        </ul>

        <p className="text-[10px] text-gray-500 mt-2">
          –≠—Ç–æ—Ç –±–ª–æ–∫ –º–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —Ä–∏—Å–∫–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∫–∏ ‚Äî —ç—Ç–æ
          –≤—ã—Å–æ–∫–æ–º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç.
        </p>
      </PixelCard>
    </div>
  );
};

const TelegramHubView = ({ onBack }) => {
  return React.createElement(
    'div',
    { className: "space-y-6 animate-in slide-in-from-right-8 duration-300" },

    // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
    React.createElement(
      'button',
      {
        onClick: onBack,
        className: "text-xs text-gray-400 hover:text-white flex items-center gap-1 mb-2"
      },
      "‚Üê –í–ï–†–ù–£–¢–¨–°–Ø"
    ),

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    React.createElement(
      'h2',
      { className: "text-xl font-bold text-white mb-4 border-b border-gray-800 pb-2" },
      "Telegram –¶–µ–Ω—Ç—Ä TVA"
    ),

    // TVA BOT
    React.createElement(
      PixelCard,
      { className: "border-blue-500/40 bg-blue-900/10" },
      React.createElement(
        'h3',
        { className: "font-bold text-blue-300 text-sm uppercase mb-2" },
        "TVA Bot ‚Äî 7 –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏"
      ),
      React.createElement(
        'ul',
        { className: "text-xs text-gray-300 space-y-1 mb-3" },
        React.createElement('li', null, "‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –Ω–∞ 7 –¥–Ω–µ–π"),
        React.createElement('li', null, "‚Ä¢ –°–∏–≥–Ω–∞–ª—ã –ø–æ Crypto / FX"),
        React.createElement('li', null, "‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"),
        React.createElement('li', null, "‚Ä¢ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —É—Ä–æ–≤–Ω–∏ —Ä—ã–Ω–∫–∞"),
      ),
      React.createElement(
        'button',
        {
          className: "w-full bg-blue-600 hover:bg-blue-500 text-white text-xs font-bold py-2 rounded border border-blue-400 transition",
          onClick: () => window.open("https://t.me/TVAAcademy_Bot", "_blank") // —Å—Å—ã–ª–∫—É –≤—Å—Ç–∞–≤–∏—à—å –ø–æ–∑–∂–µ
        },
        "–û—Ç–∫—Ä—ã—Ç—å TVA Bot"
      )
    ),

    // TVAcademy
    React.createElement(
      PixelCard,
      { className: "border-indigo-500/40 bg-indigo-900/10" },
      React.createElement(
        'h3',
        { className: "font-bold text-indigo-300 text-sm uppercase mb-2" },
        "TVAcademy ‚Äî –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª"
      ),
      React.createElement(
        'ul',
        { className: "text-xs text-gray-300 space-y-1 mb-3" },
        React.createElement('li', null, "‚Ä¢ –í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"),
        React.createElement('li', null, "‚Ä¢ –ê–Ω–æ–Ω—Å—ã —Å–æ–±—ã—Ç–∏–π –∏ –≤–∞–∂–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π"),
        React.createElement('li', null, "‚Ä¢ –ü–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Ä–∞–∑–±–æ—Ä—ã"),
        React.createElement('li', null, "‚Ä¢ –°–æ–æ–±—â–µ—Å—Ç–≤–æ —Ç—Ä–µ–π–¥–µ—Ä–æ–≤ TVA"),
      ),
      React.createElement(
        'button',
        {
          className: "w-full bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold py-2 rounded border border-indigo-400 transition",
          onClick: () => window.open("https://t.me/+sGlxGDyPdJZkNTAy", "_blank") // —Å—Å—ã–ª–∫–∞ –ø–æ—Ç–æ–º
        },
        "–û—Ç–∫—Ä—ã—Ç—å TVAcademy"
      )
    ),

    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞
    React.createElement(
      PixelCard,
      { className: "border-emerald-500/40 bg-emerald-900/10" },
      React.createElement(
        'h3',
        { className: "font-bold text-emerald-300 text-sm uppercase mb-2" },
        "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ TVA"
      ),
      React.createElement(
        'ul',
        { className: "text-xs text-gray-300 space-y-1 mb-3" },
        React.createElement('li', null, "‚Ä¢ –û—Ç–≤–µ—Ç–∏–º –Ω–∞ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å"),
        React.createElement('li', null, "‚Ä¢ –ü–æ–º–æ–∂–µ–º —Å –ø–æ–∫—É–ø–∫–æ–π –ø–æ–¥–ø–∏—Å–∫–∏"),
        React.createElement('li', null, "‚Ä¢ –†–∞–∑–±–µ—Ä—ë–º –ø—Ä–æ–±–ª–µ–º—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏"),
        React.createElement('li', null, "‚Ä¢ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: 10:00‚Äì22:00 –ø–æ –ú–°–ö"),
      ),
      React.createElement(
        'button',
        {
          className: "w-full bg-emerald-600 hover:bg-emerald-500 text-white text-xs font-bold py-2 rounded border border-emerald-400 transition",
          onClick: () => window.open("https://t.me/ICik74", "_blank") // —Å—Å—ã–ª–∫–∞ –ø–æ–∑–∂–µ
        },
        "–ù–∞–ø–∏—Å–∞—Ç—å –≤ –ü–æ–¥–¥–µ—Ä–∂–∫—É"
      )
    ),
  );
};


        const SetupForm = ({ onComplete }) => {
  const [formData, setFormData] = useState({
    goal: 'beginner',
    wakeTimeTarget: '07:00',
    sleepTimeTarget: '23:00',
    sportPerDayTarget: 30,
    readingPagesTarget: 10,
    telegramNick: '', 
  });

          const handleChange = (field, value) => {
            setFormData(prev => ({ ...prev, [field]: value }));
          };

          const handleSubmit = () => {
            if (!formData.name) return console.error("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è, –¢—Ä–µ–π–¥–µ—Ä.");
            onComplete(formData);
          };

          return (
            <PixelCard>
              <div className="space-y-4">
                <div>
                  <label className="block text-xs uppercase text-gray-500 font-bold mb-1">–ò–º—è –¢—Ä–µ–π–¥–µ—Ä–∞</label>
                  <input 
                    type="text" 
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –°–∞—Ç–æ—à–∏"
                    className="w-full bg-gray-900 border border-gray-700 text-white p-2 rounded focus:border-yellow-500 outline-none"
                    onChange={(e) => handleChange('name', e.target.value)}
                  />
                </div>

                <div>
  <label className="block text-xs uppercase text-gray-500 font-bold mb-1">
    –ù–∏–∫ –≤ Telegram
  </label>
  <input
    type="text"
    placeholder="@nickname"
    className="w-full bg-gray-900 border border-gray-700 text-white p-2 rounded focus:border-yellow-500 outline-none"
    onChange={(e) => handleChange('telegramNick', e.target.value)}
  />
  <p className="text-[10px] text-gray-500 mt-1">
    –£–∫–∞–∂–∏ —Å–≤–æ–π @–Ω–∏–∫, —á—Ç–æ–±—ã –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∏ TVA –º–æ–≥–ª–∏ –Ω–∞–π—Ç–∏ —Ç–µ–±—è –≤ –¥–µ—Ä–µ–≤–Ω–µ.
  </p>
</div>

                <div>
                  <label className="block text-xs uppercase text-gray-500 font-bold mb-1">–¢–µ–∫—É—â–∞—è –¶–µ–ª—å</label>
                  <div className="grid grid-cols-3 gap-2">
                    {[
                      { id: 'beginner', label: '–ù–æ–≤–∏—á–æ–∫' },
                      { id: 'advanced', label: '–û–ø—ã—Ç–Ω—ã–π' },
                      { id: 'pro', label: '–ü—Ä–æ—Ñ–∏' }
                    ].map((g) => (
                      <button
                        key={g.id}
                        onClick={() => handleChange('goal', g.id)}
                        className={`p-2 text-xs uppercase font-bold border rounded transition-colors ${formData.goal === g.id ? 'bg-yellow-600 border-yellow-500 text-white' : 'bg-gray-800 border-gray-700 text-gray-400'}`}
                      >
                        {g.label}
                      </button>
                    ))}
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-xs uppercase text-gray-500 font-bold mb-1">–ü–ª–∞–Ω –°–Ω–∞ (–û—Ç–±–æ–π)</label>
                    <input type="time" value={formData.sleepTimeTarget} onChange={e => handleChange('sleepTimeTarget', e.target.value)} className="w-full bg-gray-900 border border-gray-700 text-white p-2 rounded" />
                  </div>
                  <div>
                     <label className="block text-xs uppercase text-gray-500 font-bold mb-1">–ü–ª–∞–Ω –°–Ω–∞ (–ü–æ–¥—ä–µ–º)</label>
                    <input type="time" value={formData.wakeTimeTarget} onChange={e => handleChange('wakeTimeTarget', e.target.value)} className="w-full bg-gray-900 border border-gray-700 text-white p-2 rounded" />
                  </div>
                </div>

                <div>
                  <label className="block text-xs uppercase text-gray-500 font-bold mb-1">–°–ø–æ—Ä—Ç (–ú–∏–Ω/–î–µ–Ω—å)</label>
                  <input type="number" value={formData.sportPerDayTarget} onChange={e => handleChange('sportPerDayTarget', parseInt(e.target.value))} className="w-full bg-gray-900 border border-gray-700 text-white p-2 rounded" />
                </div>

                <div className="pt-4">
                  <Button onClick={handleSubmit} variant="accent" className="w-full py-3">
                     –í–æ–π—Ç–∏ –≤ –î–µ—Ä–µ–≤–Ω—é
                  </Button>
                </div>
              </div>
            </PixelCard>
          );
        };

        // --- AI COMPONENT: –•–∏–∂–∏–Ω–∞ –û—Ä–∞–∫—É–ª–∞ ---

        const OracleView = ({ player, stats, profile, onBack }) => {
          const [loading, setLoading] = useState(false);
          const [response, setResponse] = useState(null);
          const [apiKey, setApiKey] = useState(localStorage.getItem('tva_gemini_key') || '');
          const [userQuery, setUserQuery] = useState('');

          const saveKey = (val) => {
            setApiKey(val);
            localStorage.setItem('tva_gemini_key', val);
          };

          const askOracle = async () => {
            if (!apiKey) {
              setResponse("–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏ –∫–ª—é—á API (–ø–æ–ª—É—á–∏ –µ–≥–æ –≤ Google AI Studio).");
              return;
            }

            setLoading(true);
            setResponse(null);

            try {
              const genAI = new GoogleGenerativeAI(apiKey);
              const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

              // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –ò–ò
              const context = `
                –¢—ã ‚Äî "–í–µ–ª–∏–∫–∏–π –û—Ä–∞–∫—É–ª –¢—Ä–µ–π–¥–∏–Ω–≥–∞" –≤ –∏–≥—Ä–µ Trading Village Academy. 
                –¢–≤–æ–π —Ç–æ–Ω: –º—É–¥—Ä—ã–π, –Ω–µ–º–Ω–æ–≥–æ –º–∏—Å—Ç–∏—á–µ—Å–∫–∏–π, –Ω–æ —Å—Ç—Ä–æ–≥–∏–π, –∫–∞–∫ —É —Å—Ç–∞—Ä–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞ –∫—É–Ω–≥-—Ñ—É.
                
                –î–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞:
                –ò–º—è: ${profile?.name || '–¢—Ä–µ–π–¥–µ—Ä'}
                –£—Ä–æ–≤–µ–Ω—å: ${player.level}
                –û–ø—ã—Ç: ${player.currentExp}/${player.expToNextLevel}
                –ó–æ–ª–æ—Ç–æ: ${player.gold}
                –°—Ç—Ä–∏–∫ (–¥–Ω–µ–π –ø–æ–¥—Ä—è–¥): ${player.streakDays || 0}
                
                –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏):
                ${JSON.stringify(stats.slice(-3))}
                
                –í–æ–ø—Ä–æ—Å –∏–≥—Ä–æ–∫–∞: "${userQuery || '–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –º–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –¥–∞–π —Å–æ–≤–µ—Ç.'}"
                
                –ó–∞–¥–∞—á–∞: –î–∞–π –∫–æ—Ä–æ—Ç–∫–∏–π (–º–∞–∫—Å–∏–º—É–º 3-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) —Å–æ–≤–µ—Ç –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ, –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ —Ç—Ä–µ–π–¥–∏–Ω–≥–∞ –∏–ª–∏ —Ä–µ–∂–∏–º—É –¥–Ω—è, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É–π –º–µ—Ç–∞—Ñ–æ—Ä—ã –¥–µ—Ä–µ–≤–Ω–∏, —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –ø—Ä–æ–∫–∞—á–∫–∏.
              `;

              const result = await model.generateContent(context);
              const text = result.response.text();
              setResponse(text);
            } catch (error) {
              console.error(error);
              setResponse("–û—Ä–∞–∫—É–ª —Å–µ–π—á–∞—Å –≤ —Ç—É–º–∞–Ω–µ... –ü—Ä–æ–≤–µ—Ä—å API Key –∏–ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. (–û—à–∏–±–∫–∞: " + error.message + ")");
            } finally {
              setLoading(false);
            }
          };

          return (
            <div className="space-y-6 animate-in slide-in-from-right-8 duration-300">
              <button
                onClick={onBack}
                className="text-xs text-gray-400 hover:text-white flex items-center gap-1 mb-2"
              >
                <Home size={12} /> –í–ï–†–ù–£–¢–¨–°–Ø –í –î–ï–†–ï–í–ù–Æ
              </button>

              <h2 className="text-xl font-bold text-white mb-4 border-b border-gray-800 pb-2 flex items-center gap-2">
                <BrainCircuit size={24} className="text-pink-500" /> –•–ò–ñ–ò–ù–ê –û–†–ê–ö–£–õ–ê
              </h2>

              <PixelCard className="bg-gray-900/80 border-pink-500/30">
                <p className="text-xs text-gray-400 mb-4">
                  –û—Ä–∞–∫—É–ª –≤–∏–¥–∏—Ç —Ç–≤–æ–π –ø—É—Ç—å —á–µ—Ä–µ–∑ –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏ Gemini. –ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏ –Ω–∞—Å—Ç–∞–≤–ª–µ–Ω–∏—è.
                </p>

                {/* –ü–æ–ª–µ –¥–ª—è API Key */}
                <div className="mb-4">
                  <label className="text-[10px] uppercase text-gray-600 font-bold">
                    Google Gemini API Key
                  </label>
                  <input
                    type="password"
                    value={apiKey}
                    onChange={(e) => saveKey(e.target.value)}
                    placeholder="–í—Å—Ç–∞–≤—å –∫–ª—é—á —Å—é–¥–∞..."
                    className="w-full bg-black border border-gray-700 text-xs text-white p-2 rounded focus:border-pink-500 outline-none"
                  />
                  <a
                    href="https://aistudio.google.com/app/apikey"
                    target="_blank"
                    rel="noreferrer"
                    className="text-[10px] text-blue-400 underline mt-1 block"
                  >
                    –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á –±–µ—Å–ø–ª–∞—Ç–Ω–æ
                  </a>
                </div>

                {/* –ü–æ–ª–µ –≤–æ–ø—Ä–æ—Å–∞ */}
                <div className="mb-4">
                  <label className="text-[10px] uppercase text-gray-500 font-bold">
                    –¢–≤–æ–π –≤–æ–ø—Ä–æ—Å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                  </label>
                  <textarea
                    value={userQuery}
                    onChange={(e) => setUserQuery(e.target.value)}
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ø –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –Ω–∞—Ä—É—à–∞—é —Ä–µ–∂–∏–º —Å–Ω–∞, —á—Ç–æ –¥–µ–ª–∞—Ç—å?"
                    className="w-full bg-gray-800 border border-gray-600 text-xs text-white p-2 rounded h-20 focus:border-pink-500 outline-none"
                  />
                </div>

                <Button
                  onClick={askOracle}
                  variant="primary"
                  disabled={loading || !apiKey}
                  className="w-full py-3 bg-pink-700 hover:bg-pink-600 border-pink-900"
                >
                  {loading ? "–û–†–ê–ö–£–õ –î–£–ú–ê–ï–¢..." : "–ü–û–õ–£–ß–ò–¢–¨ –ü–†–ï–î–°–ö–ê–ó–ê–ù–ò–ï ‚ú®"}
                </Button>
              </PixelCard>

              {/* –û—Ç–≤–µ—Ç */}
              {response && (
                <div className="animate-in fade-in duration-500">
                  <PixelCard className="border-pink-500 bg-pink-900/10">
                    <div className="flex items-start gap-3">
                      <div className="text-2xl">üîÆ</div>
                      <div>
                        <h3 className="text-sm font-bold text-pink-400 mb-1">–ì–æ–ª–æ—Å –ë–µ–∑–¥–Ω—ã:</h3>
                        <p className="text-sm text-gray-200 leading-relaxed italic">
                          "{response}"
                        </p>
                      </div>
                    </div>
                  </PixelCard>
                </div>
              )}
            </div>
          );
        };

        // --- MAIN APP ---

        function App() {
          const [loading, setLoading] = useState(true);
          const [profile, setProfile] = useState(null);
          const [player, setPlayer] = useState(INITIAL_PLAYER_STATE);
          const [tasks, setTasks] = useState([]);
          const [showBalanceTestPrompt, setShowBalanceTestPrompt] = useState(false);
          const [stats, setStats] = useState([]);
          const [villageUpgrades, setVillageUpgrades] = useState(INITIAL_UPGRADES_STATE);
          const [artifacts, setArtifacts] = useState([]); 
          const [weeklyChallenge, setWeeklyChallenge] = useState(null);
          
          const [view, setView] = useState('setup'); // view: setup | village | shop | inventory | talents | stats | roadmap
          const [selectedLocation, setSelectedLocation] = useState(null);
          const [showLevelUp, setShowLevelUp] = useState(false);
          const [lastGainedArtifact, setLastGainedArtifact] = useState(null); 
          const [showChallengeComplete, setShowChallengeComplete] = useState(false);
          const [message, setMessage] = useState(null); 
          const viewKey = `${view}-${selectedLocation ? selectedLocation.id : 'none'}`;
          const tg = window.Telegram?.WebApp;
if (tg) {
  tg.expand(); // —Ä–∞—Å—Ç—è–Ω—É—Ç—å –º–∏–Ω–∏-–∞–ø–ø –Ω–∞ –≤—Å—é –≤—ã—Å–æ—Ç—É
}

          const goToView = (nextView) => {
            setSelectedLocation(null);
            setView(nextView);
          };

          const equippedArtifacts = useMemo(() => {
            return artifacts.filter(a => player.equippedArtifactIds.includes(a.id));
          }, [artifacts, player.equippedArtifactIds]);

          const extraTaskSlots = useMemo(() => {
            const fromTalents = Object.entries(player.unlockedTalents || {}).reduce((total, [id, level]) => {
              const talent = TALENTS_DATA.find(t => t.id === id);
              if (talent && talent.effect === 'extra_task_slot') {
                return total + talent.baseValue * level;
              }
              return total;
            }, 0);

            const fromBuildings = player.buildingTaskSlots || 0;

            const subBonuses = getSubscriptionBonuses(player.subscriptionTier || 'basic');
            const fromSubscription = subBonuses.extraTaskSlots || 0;

            const fromPremium = player.hasPremiumPass ? 3 : 0; // –Ω–∞–ø—Ä–∏–º–µ—Ä, Premium Pass –¥–∞—ë—Ç +3

            return fromTalents + fromBuildings + fromSubscription + fromPremium;
          }, [player.unlockedTalents, player.buildingTaskSlots, player.subscriptionTier, player.hasPremiumPass]);

          useEffect(() => {
  const savedProfile   = localStorage.getItem(STORAGE_KEYS.PROFILE);
  const savedPlayerStr = localStorage.getItem(STORAGE_KEYS.PLAYER);
  const savedTasksStr  = localStorage.getItem(STORAGE_KEYS.TASKS);
  const savedStatsStr  = localStorage.getItem(STORAGE_KEYS.STATS);
  const savedUpgStr    = localStorage.getItem(STORAGE_KEYS.UPGRADES);
  const savedArtStr    = localStorage.getItem(STORAGE_KEYS.ARTIFACTS);
  const savedChallengeStr = localStorage.getItem(STORAGE_KEYS.CHALLENGE);

  // --- –ø—Ä–æ—Ñ–∏–ª—å ---
if (savedProfile) {
  const loadedProfile = JSON.parse(savedProfile);
  setProfile(loadedProfile);
  setView('village');

  if (!loadedProfile.balanceTestCompleted) {
    setShowBalanceTestPrompt(true); // üëà –µ—Å–ª–∏ –µ—â—ë –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª —Ç–µ—Å—Ç
  }
}

  // --- –∏–≥—Ä–æ–∫ ---
  let loadedPlayer = savedPlayerStr ? JSON.parse(savedPlayerStr) : INITIAL_PLAYER_STATE;

  if (!loadedPlayer.unlockedTalents) loadedPlayer.unlockedTalents = {};
  if (typeof loadedPlayer.buildingTaskSlots !== 'number') {
    loadedPlayer.buildingTaskSlots = 0; // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
  }

  // üî• –§–æ–ª–±—ç–∫–∏ Premium / –ø–æ–¥–ø–∏—Å–æ–∫ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
  if (typeof loadedPlayer.hasPremiumPass !== 'boolean') {
    loadedPlayer.hasPremiumPass = false;
  }
  if (typeof loadedPlayer.subscriptionTier === 'undefined') {
    loadedPlayer.subscriptionTier = null;
  }

  setPlayer(loadedPlayer);

  // --- —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ / –∞–ø–≥—Ä–µ–π–¥—ã / –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã ---
  if (savedStatsStr)  setStats(JSON.parse(savedStatsStr));
  if (savedUpgStr)    setVillageUpgrades(JSON.parse(savedUpgStr));
  if (savedArtStr)    setArtifacts(JSON.parse(savedArtStr));

  const today = getTodayString();

  // === –í–ê–ñ–ù–û: —Å—á–∏—Ç–∞–µ–º extraSlots –∏–∑ —Ç–∞–ª–∞–Ω—Ç–æ–≤ + –∑–¥–∞–Ω–∏–π + Premium ===
  const loadedExtraSlotsFromTalents = Object.entries(loadedPlayer.unlockedTalents || {}).reduce(
    (total, [id, level]) => {
      const talent = TALENTS_DATA.find(t => t.id === id);
      if (talent && talent.effect === 'extra_task_slot') {
        return total + talent.baseValue * level;
      }
      return total;
    },
    0
  );

  const loadedExtraSlotsFromBuildings = loadedPlayer.buildingTaskSlots || 0;

  const subBonusesOnLoad = getSubscriptionBonuses(loadedPlayer.subscriptionTier || 'basic');
  const loadedExtraSlotsFromSub = subBonusesOnLoad.extraTaskSlots || 0;

  const loadedExtraSlotsFromPremium = loadedPlayer.hasPremiumPass ? 3 : 0;

  const loadedExtraSlots =
    loadedExtraSlotsFromTalents +
    loadedExtraSlotsFromBuildings +
    loadedExtraSlotsFromSub +
    loadedExtraSlotsFromPremium;

  // --- –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è ---
  let currentTasks = [];
  if (savedTasksStr) {
    const allTasks = JSON.parse(savedTasksStr);
    if (allTasks[today]) {
      currentTasks = allTasks[today];
    } else {
      currentTasks = generateDailyTasks(today, loadedExtraSlots);
    }
  } else {
    currentTasks = generateDailyTasks(today, loadedExtraSlots);
  }
  setTasks(currentTasks);

  // --- –Ω–µ–¥–µ–ª—å–Ω—ã–π —á–µ–ª–ª–µ–Ω–¥–∂ ---
  let challenge;
  if (savedChallengeStr) {
    const loadedChallenge = JSON.parse(savedChallengeStr);
    if (getWeekId() === getWeekId(loadedChallenge.startDate)) {
      challenge = loadedChallenge;
      if (challenge.isCompleted && !challenge.isClaimed) {
        setShowChallengeComplete(true);
      }
    } else {
      challenge = generateWeeklyChallenge(today);
    }
  } else {
    challenge = generateWeeklyChallenge(today);
  }
  setWeeklyChallenge(challenge);

  setLoading(false);
}, []);

          useEffect(() => {
            if (loading) return;
            localStorage.setItem(STORAGE_KEYS.PLAYER, JSON.stringify(player));
            localStorage.setItem(STORAGE_KEYS.PROFILE, JSON.stringify(profile));
            localStorage.setItem(STORAGE_KEYS.STATS, JSON.stringify(stats));
            localStorage.setItem(STORAGE_KEYS.UPGRADES, JSON.stringify(villageUpgrades));
            localStorage.setItem(STORAGE_KEYS.ARTIFACTS, JSON.stringify(artifacts)); 
            localStorage.setItem(STORAGE_KEYS.CHALLENGE, JSON.stringify(weeklyChallenge));
            
            const today = getTodayString();
            const existingTasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.TASKS) || '{}');
            existingTasks[today] = tasks;
            localStorage.setItem(STORAGE_KEYS.TASKS, JSON.stringify(existingTasks));
          }, [player, profile, tasks, stats, villageUpgrades, artifacts, weeklyChallenge, loading]);

          const handleToggleEquip = (artifact) => {
            if (!artifact.isEquippable) return;

            setPlayer(prevPlayer => {
              const isEquipped = prevPlayer.equippedArtifactIds.includes(artifact.id);
              let newEquippedIds = [...prevPlayer.equippedArtifactIds];

              const maxSlots = calculateMaxEquipSlots(prevPlayer);

              if (isEquipped) {
                newEquippedIds = newEquippedIds.filter(id => id !== artifact.id);
              } else {
                if (newEquippedIds.length >= maxSlots) {
                  setMessage({
                    text: `–ù–µ–ª—å–∑—è —ç–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å –±–æ–ª–µ–µ ${maxSlots} –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ! (—É–≤–µ–ª–∏—á—å –ø–æ–¥–ø–∏—Å–∫—É –∏–ª–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π Premium Pass)`,
                    type: 'error'
                  });
                  setTimeout(() => setMessage(null), 3000);
                  return prevPlayer;
                }
                newEquippedIds.push(artifact.id);
              }

              return { ...prevPlayer, equippedArtifactIds: newEquippedIds };
            });
          };

          const handleCreateProfile = (newProfile) => {
  const profileWithMeta = {
    ...newProfile,
    balanceTestCompleted: false,   // –µ—â—ë –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª —Ç–µ—Å—Ç
    balanceScores: null,          // —Å—é–¥–∞ –ø–æ–ª–æ–∂–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–ª–µ—Å–∞
  };

  setProfile(profileWithMeta);
  setView('village');
  setShowBalanceTestPrompt(true); // üëà –ø–æ–∫–∞–∂–µ–º –ø–∞–º—è—Ç–∫—É –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç
};

          const handleCompleteTask = (taskId) => {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1 || tasks[taskIndex].completed) return;

            const task = tasks[taskIndex];
            const newTasks = [...tasks];
            newTasks[taskIndex].completed = true;
            newTasks[taskIndex].completedAt = new Date().toISOString();
            setTasks(newTasks);

            let expGain = task.exp;
            let goldGain = expGain * 2;
            
            const talentExpBoost = Object.entries(player.unlockedTalents).reduce((total, [id, level]) => {
              const talent = TALENTS_DATA.find(t => t.id === id);
              if (talent && talent.effect === 'exp_boost') {
                  return total + talent.baseValue * level;
              }
              return total;
            }, 0);
            expGain = Math.round(expGain * (1 + talentExpBoost));

            const talentGoldBoost = Object.entries(player.unlockedTalents).reduce((total, [id, level]) => {
              const talent = TALENTS_DATA.find(t => t.id === id);
              if (talent && talent.effect === 'gold_boost') {
                  return total + talent.baseValue * level;
              }
              return total;
            }, 0);
            goldGain = Math.round(goldGain * (1 + talentGoldBoost));
            const subBonuses = getSubscriptionBonuses(player.subscriptionTier || 'basic');
            const subGoldMult = subBonuses.goldMultiplier || 1.0;
            goldGain = Math.round(goldGain * subGoldMult);

            equippedArtifacts.forEach(artifact => {
                if (artifact.effectType === 'exp_multiplier' && 
                   (artifact.targetCategory === 'all' || artifact.targetCategory === task.category)
                ) {
                    expGain = Math.round(expGain * (artifact.effectValue - 1) + expGain); 
                }
                if (artifact.effectType === 'gold_multiplier' && artifact.targetCategory === 'all') {
                    goldGain = Math.round(goldGain * (artifact.effectValue - 1) + goldGain);
                }
            });

            const { newLevel, newExp, newNeeded, leveledUp } = calculateLevel(player.level, player.currentExp + expGain, player.expToNextLevel);

            setPlayer(prev => ({
              ...prev,
              level: newLevel,
              currentExp: newExp,
              expToNextLevel: newNeeded,
              totalExp: prev.totalExp + expGain,
              gold: prev.gold + goldGain,
            }));

            if (leveledUp) {
              const newArtifact = generateRandomArtifact();
              setArtifacts(prev => [...prev, newArtifact]);
              setLastGainedArtifact(newArtifact);
              setShowLevelUp(true);
            }
            
            if (weeklyChallenge && !weeklyChallenge.isCompleted && task.category === weeklyChallenge.targetCategory) {
                setWeeklyChallenge(prev => {
                    if (!prev) return null;
                    const newProgress = prev.currentProgress + 1;
                    const isCompleted = newProgress >= prev.requiredCompletions;
                    
                    if (isCompleted) {
                        setShowChallengeComplete(true);
                    }

                    return { 
                        ...prev, 
                        currentProgress: newProgress,
                        isCompleted: isCompleted,
                    };
                });
            }

            const today = getTodayString();
const statsIdx = stats.findIndex(s => s.date === today);
let newStats = [...stats];

if (statsIdx === -1) {
  newStats.push({
    date: today,
    tasksCompleted: 1,
    expGained: expGain,

    // –£–∂–µ –±—ã–ª–∏:
    sportMinutes: task.category === 'sport' ? task.value : 0,
    pagesRead: task.category === 'learning' && task.unit === 'pages' ? task.value : 0,
    videosWatched: task.category === 'learning' && task.unit === 'video' ? task.value : 0,
    chartSessions: task.category === 'charts' ? 1 : 0,

    // –ù–æ–≤—ã–µ –ø–æ–ª—è:
    sleepTasks: task.category === 'sleep' ? 1 : 0,
    learningTasks: task.category === 'learning' ? 1 : 0,
    researchTasks: task.category === 'research' ? 1 : 0,
    planningTasks: task.category === 'planning' ? 1 : 0,
  });
} else {
  const dayStat = newStats[statsIdx];
  newStats[statsIdx] = {
    ...dayStat,
    tasksCompleted: dayStat.tasksCompleted + 1,
    expGained: dayStat.expGained + expGain,

    sportMinutes:
      task.category === 'sport'
        ? dayStat.sportMinutes + task.value
        : dayStat.sportMinutes,

    pagesRead:
      task.category === 'learning' && task.unit === 'pages'
        ? dayStat.pagesRead + task.value
        : dayStat.pagesRead,

    videosWatched:
      task.category === 'learning' && task.unit === 'video'
        ? dayStat.videosWatched + task.value
        : dayStat.videosWatched,

    chartSessions:
      task.category === 'charts'
        ? dayStat.chartSessions + 1
        : dayStat.chartSessions,

    // –ù–æ–≤—ã–µ –ø–æ–ª—è —Å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ–º:
    sleepTasks:
      task.category === 'sleep'
        ? (dayStat.sleepTasks || 0) + 1
        : (dayStat.sleepTasks || 0),

    learningTasks:
      task.category === 'learning'
        ? (dayStat.learningTasks || 0) + 1
        : (dayStat.learningTasks || 0),

    researchTasks:
      task.category === 'research'
        ? (dayStat.researchTasks || 0) + 1
        : (dayStat.researchTasks || 0),

    planningTasks:
      task.category === 'planning'
        ? (dayStat.planningTasks || 0) + 1
        : (dayStat.planningTasks || 0),
  };
}

setStats(newStats);

            const bonusExp = expGain - task.exp;
            const bonusGold = goldGain - (task.exp * 2);

            let messageText = `–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! +${task.exp} EXP (+${task.exp * 2} ü™ô).`;
            if (bonusExp > 0 || bonusGold > 0) {
                messageText += ` –ë–æ–Ω—É—Å: +${bonusExp} EXP (+${bonusGold} ü™ô).`;
            }

            setMessage({ text: messageText, type: 'success' });
            setTimeout(() => setMessage(null), 3000);
          };

          const handleUpgrade = (locationId, cost) => {
            if (player.gold < cost) {
                setMessage({ text: "–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–æ–ª–æ—Ç–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è! –í—ã–ø–æ–ª–Ω—è–π –±–æ–ª—å—à–µ –∑–∞–¥–∞—á.", type: 'error' });
                setTimeout(() => setMessage(null), 3000);
                return;
            }

            setPlayer(prev => ({ ...prev, gold: prev.gold - cost }));
            setVillageUpgrades(prev => ({ ...prev, [locationId]: (prev[locationId] || 1) + 1 }));
            
            setMessage({ text: "–£–ª—É—á—à–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! –¢–≤–æ—è –¥–µ—Ä–µ–≤–Ω—è —Å—Ç–∞–ª–∞ –∫—Ä—É—á–µ!", type: 'success' });
            setTimeout(() => setMessage(null), 3000);
          };

          const handleSaveProfileSettings = (updatedProfile, goldCost) => {
  if (player.gold < goldCost) {
    setMessage({ text: `–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–æ–ª–æ—Ç–∞! –ù—É–∂–Ω–æ ${goldCost} ü™ô`, type: 'error' });
    setTimeout(() => setMessage(null), 3000);
    return;
  }

  setPlayer((prev) => ({
    ...prev,
    gold: prev.gold - goldCost,
  }));
  setProfile(updatedProfile);

  setMessage({ text: '–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω!', type: 'success' });
  setTimeout(() => setMessage(null), 3000);

  goToView('village');
};

          const handleBuyBuilding = () => {
  const currentBuildings = player.buildingTaskSlots || 0;
  const maxBuildings = 5; // –Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞–∫—Å–∏–º—É–º 5 –∑–¥–∞–Ω–∏–π

  if (currentBuildings >= maxBuildings) {
    setMessage({
      text: "–î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º –∑–¥–∞–Ω–∏–π. –î–µ—Ä–µ–≤–Ω—è –Ω–µ –≤—ã–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à–µ —Å—Ç—Ä–æ–µ–∫!",
      type: 'error'
    });
    setTimeout(() => setMessage(null), 3000);
    return;
  }

  // —Ñ–æ—Ä–º—É–ª–∞ —Ü–µ–Ω—ã: –∫–∞–∂–¥–æ–µ —Å–ª–µ–¥—É—é—â–µ–µ –∑–¥–∞–Ω–∏–µ –¥–æ—Ä–æ–∂–µ
  const nextCost = 1500 * (currentBuildings + 1);

  if (player.gold < nextCost) {
    setMessage({
      text: `–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–æ–ª–æ—Ç–∞! –ù—É–∂–Ω–æ ${nextCost} ü™ô`,
      type: 'error'
    });
    setTimeout(() => setMessage(null), 3000);
    return;
  }

  setPlayer(prev => ({
    ...prev,
    gold: prev.gold - nextCost,
    buildingTaskSlots: (prev.buildingTaskSlots || 0) + 1
  }));

  setMessage({
    text: `–ü–æ—Å—Ç—Ä–æ–µ–Ω–æ –Ω–æ–≤–æ–µ –∑–¥–∞–Ω–∏–µ! –¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è +1 –¥–æ–ø. –∑–∞–¥–∞–Ω–∏–µ –≤ –¥–µ–Ω—å (–≤—Å–µ–≥–æ: ${currentBuildings + 1}).`,
    type: 'success'
  });
  setTimeout(() => setMessage(null), 3000);
};
          
          const handleUnlockTalent = (talentId, currentLevel) => {
            const talentData = TALENTS_DATA.find(t => t.id === talentId);
            if (!talentData) return;

            const nextLevel = currentLevel + 1;
            if (nextLevel > talentData.maxLevel) {
                setMessage({ text: "–¢–∞–ª–∞–Ω—Ç —É–∂–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω!", type: 'error' });
                return;
            }

            if (talentData.prereqTalentId && (player.unlockedTalents[talentData.prereqTalentId] || 0) < 1) {
                const prereqName = TALENTS_DATA.find(t => t.id === talentData.prereqTalentId)?.name || '–ü—Ä–µ–¥—ã–¥—É—â–∏–π –¢–∞–ª–∞–Ω—Ç';
                setMessage({ text: `–°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –∏–∑—É—á–∏—Ç—å: "${prereqName}"`, type: 'error' });
                return;
            }

            const cost = talentData.cost * nextLevel;
            if (player.gold < cost) {
                setMessage({ text: `–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–æ–ª–æ—Ç–∞! –ù—É–∂–Ω–æ ${cost} ü™ô`, type: 'error' });
                return;
            }

            setPlayer(prev => ({ 
                ...prev, 
                gold: prev.gold - cost,
                unlockedTalents: {
                    ...prev.unlockedTalents,
                    [talentId]: nextLevel,
                }
            }));
            setMessage({ text: `–¢–∞–ª–∞–Ω—Ç "${talentData.name}" —É–ª—É—á—à–µ–Ω –¥–æ —É—Ä. ${nextLevel}!`, type: 'success' });
            setTimeout(() => setMessage(null), 3000);
          };

          // üîπ –Ω–æ–≤—ã–π —Ö–µ–Ω–¥–ª–µ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
  const handleUpdateTaskComment = (taskId, comment) => {
    setTasks(prevTasks =>
      prevTasks.map(t =>
        t.id === taskId ? { ...t, comment } : t
      )
    );
  };

          const handleClaimChallenge = () => {
              if (!weeklyChallenge || !weeklyChallenge.isCompleted || weeklyChallenge.isClaimed) return;

              setPlayer(prev => ({
                  ...prev,
                  gold: prev.gold + weeklyChallenge.goldReward,
                  totalExp: prev.totalExp + weeklyChallenge.expReward,
              }));

              setWeeklyChallenge(prev => prev ? { ...prev, isClaimed: true } : null);
              setShowChallengeComplete(false);
              setMessage({ text: `–ò—Å–ø—ã—Ç–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ü–æ–ª—É—á–µ–Ω–æ +${weeklyChallenge.expReward} EXP –∏ ${weeklyChallenge.goldReward} ü™ô`, type: 'success' });
              setTimeout(() => setMessage(null), 5000);
          }

          //  –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å Premium Pass
const handleActivatePremium = () => {
  if (player.hasPremiumPass) {
    setMessage({
      text: "Premium Pass —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!",
      type: 'success'
    });
    setTimeout(() => setMessage(null), 3000);
    return;
  }

  setPlayer(prev => ({
    ...prev,
    hasPremiumPass: true,
  }));

  setMessage({
    text: "Premium Pass –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è +3 –¥–æ–ø. –∑–∞–¥–∞–Ω–∏—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ.",
    type: 'success'
  });
  setTimeout(() => setMessage(null), 3000);
};

//  –í—ã–±—Ä–∞—Ç—å / –∏–∑–º–µ–Ω–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–ø–∏—Å–∫–∏
          const handleSetSubscriptionTier = (tier) => {
            // –µ—Å–ª–∏ —É–∂–µ –≤—ã–±—Ä–∞–Ω —ç—Ç–æ—Ç –∂–µ tier ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∂–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (player.subscriptionTier === tier) {
              setMessage({
                text: `–ü–æ–¥–ø–∏—Å–∫–∞ ${tier.toUpperCase()} —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞.`,
                type: 'success'
              });
              setTimeout(() => setMessage(null), 3000);
              return;
            }

            setPlayer(prev => ({
              ...prev,
              subscriptionTier: tier,
            }));

            setMessage({
              text: `–ü–æ–¥–ø–∏—Å–∫–∞ ${tier.toUpperCase()} –≤—ã–±—Ä–∞–Ω–∞ (–¥–µ–º–æ-—Ä–µ–∂–∏–º).`,
              type: 'success'
            });
            setTimeout(() => setMessage(null), 3000);
          };

          if (loading) return React.createElement('div', { className: "min-h-screen bg-[#0b0f1a] text-white flex items-center justify-center font-mono" }, "–ó–∞–≥—Ä—É–∑–∫–∞ –î–µ—Ä–µ–≤–Ω–∏...");

          return React.createElement('div', { className: "min-h-screen bg-[#0b0f1a] text-gray-200 font-mono selection:bg-yellow-500 selection:text-black" },
            
            profile && React.createElement(
  'header',
  {
    className:
      "sticky top-0 z-30 bg-[#0b0f1a]/90 backdrop-blur-sm border-b border-gray-800 p-3 shadow-md"
  },
  React.createElement(
    'div',
    { className: "max-w-md mx-auto w-full flex flex-col gap-2" },

    // üîπ –†—è–¥ 1 ‚Äî –õ–æ–≥–æ + TVA
    React.createElement(
      'div',
      {
        className: "flex items-center gap-2 min-w-0 cursor-pointer",
        onClick: () => goToView('village')
      },
      React.createElement(
        'div',
        {
          className:
            "w-8 h-8 bg-yellow-600 rounded flex items-center justify-center border border-yellow-400 flex-shrink-0"
        },
        React.createElement('span', { className: "text-xl" }, "üè∞")
      ),
      React.createElement(
        'div',
        { className: "leading-none overflow-hidden" },
        React.createElement(
          'h1',
          { className: "font-bold text-yellow-500 text-sm tracking-wider" },
          "TVA"
        ),
        React.createElement(
          'span',
          {
            className:
              "hidden sm:block text-[10px] text-gray-400 truncate max-w-[180px]"
          },
          "TRADING VILLAGE ACADEMY"
        )
      )
    ),

    // üîπ –†—è–¥ 2 ‚Äî —Å—Ç–∞—Ç—É—Å / —Ä–µ—Å—É—Ä—Å—ã / —É—Ä–æ–≤–µ–Ω—å / —Ä–æ–∞–¥–º–∞–ø
    React.createElement(
      'div',
      {
        className:
          "flex items-center justify-between gap-2 flex-wrap"
      },

      // –ö–∞–ª–µ–Ω–¥–∞—Ä—å (–º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å —Å–æ–≤—Å–µ–º –Ω–∞ —Å–≤–µ—Ä—Ö-—É–∑–∫–∏—Ö, –µ—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å)
      weeklyChallenge && React.createElement(
        'button',
        {
          onClick: () => setShowChallengeComplete(true),
          className: `p-1.5 rounded transition-all border ${
            weeklyChallenge.isCompleted && !weeklyChallenge.isClaimed
              ? 'bg-red-700 border-red-400 animate-pulse'
              : 'bg-gray-800 border-gray-700'
          }`
        },
        React.createElement(Calendar, {
          size: 18,
          className:
            weeklyChallenge.isCompleted && !weeklyChallenge.isClaimed
              ? 'text-white'
              : 'text-gray-400'
        })
      ),

      // –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
      React.createElement(
        'div',
        { className: "flex -space-x-1" },
        Array.from({ length: 3 }).map((_, index) =>
          React.createElement(
            'div',
            {
              key: index,
              className: `w-5 h-5 rounded-full flex items-center justify-center text-xs border-2 ${
                equippedArtifacts[index]
                  ? 'bg-yellow-800 border-yellow-500 shadow-lg'
                  : 'bg-gray-800 border-gray-700 opacity-50'
              }`,
              onClick: () => {
                setSelectedLocation(null);
                setView('inventory');
              }
            },
            equippedArtifacts[index] ? equippedArtifacts[index].visual : '‚Äî'
          )
        )
      ),

      // –ó–æ–ª–æ—Ç–æ
      React.createElement(
        'div',
        {
          className:
            "flex items-center gap-1 bg-gray-800 px-2 py-1 rounded-full text-yellow-400 border border-gray-700"
        },
        React.createElement(Gem, { size: 14, className: "text-yellow-500" }),
        React.createElement(
          'span',
          { className: "text-xs font-bold" },
          player.gold
        )
      ),

      // –£—Ä–æ–≤–µ–Ω—å + EXP
      React.createElement(
        'div',
        { className: "text-right" },
        React.createElement(
          'div',
          { className: "text-xs text-yellow-500 font-bold" },
          `–£–† ${player.level}`
        ),
        React.createElement(
          'div',
          { className: "w-24" },
          React.createElement(ProgressBar, {
            current: player.currentExp,
            max: player.expToNextLevel
          })
        )
      ),

      // –ö–Ω–æ–ø–∫–∞ Roadmap
      React.createElement(
        'button',
        {
          onClick: () => goToView('roadmap'),
          className: "p-2 hover:bg-gray-800 rounded transition-colors"
        },
        React.createElement(FileText, { size: 20, className: "text-gray-400" })
      )
    )
  )
),

            React.createElement('main',{ className: "max-w-md mx-auto p-4 pb-24" },

            React.createElement(MotivationFooter, null),

            

  // --- —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ ---
  !profile && React.createElement(
    'div',
    { className: "animate-in fade-in slide-in-from-bottom-4 duration-700" },
    React.createElement(
      'div',
      { className: "text-center mb-8 pt-10" },
      React.createElement(
        'h1',
        { className: "text-3xl font-bold text-yellow-500 mb-2" },
        "–î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨"
      ),
      React.createElement(
        'p',
        { className: "text-gray-400 text-sm" },
        "–°–æ–∑–¥–∞–π –ø—Ä–æ—Ñ–∏–ª—å, —á—Ç–æ–±—ã –≤–æ–π—Ç–∏ –≤ –ê–∫–∞–¥–µ–º–∏—é."
      )
    ),
    React.createElement(SetupForm, { onComplete: handleCreateProfile })
  ),

  // --- –≥–ª–∞–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –¥–µ—Ä–µ–≤–Ω–∏ ---
  profile && view === 'village' && !selectedLocation && React.createElement(
    'div',
    { className: "space-y-6 animate-in fade-in duration-500" },

    React.createElement(
      PixelCard,
      { className: "bg-gradient-to-r from-gray-900 to-gray-800 border-yellow-900/50" },
      React.createElement(
        'div',
        {
          className: "flex flex-wrap items-center gap-2 mb-2"
        },
        // –õ–ï–í–ê–Ø –ß–ê–°–¢–¨: –ò–º—è —Ç—Ä–µ–π–¥–µ—Ä–∞
        React.createElement(
          'div',
          {
            className: "flex items-center gap-2 cursor-pointer",
            onClick: () => goToView('profile_edit')
          },
          React.createElement(
            'div',
            { className: "bg-yellow-500/10 p-1.5 rounded text-yellow-500" },
            React.createElement(User, { size: 16 })
          ),
          React.createElement(
            'span',
            { className: "font-bold text-white" },
            profile.name
          )
        ),

        // –ö–Ω–æ–ø–∫–∞ "–ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞"
        profile.balanceTestCompleted && React.createElement(
          'button',
          {
            onClick: () => goToView('balance_results'),
            className:
              "flex-1 sm:flex-none w-full sm:w-auto px-3 bg-indigo-600 hover:bg-indigo-500 " +
              "text-white text-[9px] uppercase font-semibold py-1 rounded-full border " +
              "border-indigo-400 transition-colors flex items-center justify-center gap-1"
          },
          React.createElement(Target, { size: 12 }),
          "–û—Ç–∫—Ä—ã—Ç—å –ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞"
        ),

        // –ë–µ–π–¥–∂ —Å—Ç–∞—Ç—É—Å–∞ (–ù–æ–≤–∏—á–æ–∫ / –û–ø—ã—Ç–Ω—ã–π / –ü—Ä–æ—Ñ–∏)
        React.createElement('span', {
          onClick: () => goToView('stats'),
          className:
            "text-xs bg-gray-700 px-2 py-1 rounded text-yellow-400 uppercase cursor-pointer " +
            "hover:bg-yellow-500 hover:text-black transition-all border border-yellow-600"
        },
          "üìä ",
          profile.goal === 'beginner' ? '–ù–æ–≤–∏—á–æ–∫'
            : profile.goal === 'advanced' ? '–û–ø—ã—Ç–Ω—ã–π'
              : '–ü—Ä–æ—Ñ–∏'
        )
      ),

      (player.hasPremiumPass || player.subscriptionTier) && React.createElement(
    'div',
    { className: "flex items-center gap-2 mb-2 text-[10px]" },

    // –ë–µ–π–¥–∂ Premium
    player.hasPremiumPass && React.createElement(
      'span',
      {
        className:
          "inline-flex items-center gap-1 px-2 py-1 rounded-full " +
          "bg-yellow-500/15 border border-yellow-500/60 text-yellow-300 font-bold uppercase tracking-widest"
      },
      React.createElement(Crown, { size: 12, className: "text-yellow-300" }),
      'Premium Pass'
    ),
    

    // –ü–æ–¥–ø–∏—Å–∫–∞ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞)
    player.subscriptionTier && React.createElement(
      'span',
      {
        className:
          "inline-flex items-center gap-1 px-2 py-1 rounded-full " +
          "bg-indigo-500/10 border border-indigo-500/60 text-indigo-200 uppercase"
      },
      'Sub: ',
      player.subscriptionTier === 'basic'
        ? 'Basic'
        : player.subscriptionTier === 'advanced'
          ? 'Advanced'
          : 'Pro'
    )
  ),

      React.createElement(
        'div',
        { className: "grid grid-cols-3 gap-2 mt-4 text-xs" },
        React.createElement(
          'div',
          { className: "bg-[#0b0f1a] p-2 rounded border border-gray-800" },
          React.createElement(
            'span',
            { className: "block text-gray-500 mb-1" },
            "–í—Å–µ–≥–æ –æ–ø—ã—Ç–∞"
          ),
          React.createElement(
            'span',
            { className: "text-lg font-bold text-yellow-400" },
            player.totalExp
          )
        ),
        React.createElement(
          'div',
          { className: "bg-[#0b0f1a] p-2 rounded border border-gray-800" },
          React.createElement(
            'span',
            { className: "block text-gray-500 mb-1" },
            "–¢–∞–ª–∞–Ω—Ç–æ–≤"
          ),
          React.createElement(
            'span',
            { className: "text-lg font-bold text-purple-400 flex items-center gap-1" },
            React.createElement(Star, { size: 18 }),
            Object.keys(player.unlockedTalents).length
          )
        ),
        
        React.createElement(
          'div',
          {
            className:
              "bg-[#0b0f1a] p-2 rounded border border-gray-800 cursor-pointer hover:border-yellow-500",
            onClick: () => goToView('inventory')
          },
          React.createElement(
            'span',
            { className: "block text-gray-500 mb-1" },
            "–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã"
          ),
          React.createElement(
            'span',
            { className: "text-lg font-bold text-blue-400 flex items-center gap-1" },
            React.createElement(Pocket, { size: 18 }),
            artifacts.length
          )
        )
      ),

      React.createElement(
  'div',
  { className: "grid grid-cols-2 gap-2 mt-4" },

  // 1 —Ä—è–¥: –ú–∞–≥–∞–∑–∏–Ω | Premium Pass
  React.createElement(
    'button',
    {
      onClick: () => goToView('shop'),
      className: "bg-orange-500 hover:bg-orange-400 text-white text-xs uppercase font-bold py-2 rounded border border-orange-300 transition-colors"
    },
    "–ú–ê–ì–ê–ó–ò–ù"
  ),

  React.createElement(
    'button',
    {
      onClick: () => goToView('premium'),
      className: "bg-yellow-500 hover:bg-yellow-400 text-black text-xs uppercase font-bold py-2 rounded border border-yellow-300 transition-colors"
    },
    "PREMIUM PASS"
  ),

  // 2 —Ä—è–¥: –¢–∞–ª–∞–Ω—Ç—ã | –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
  React.createElement(
    'button',
    {
      onClick: () => goToView('talents'),
      className: "bg-blue-700 hover:bg-blue-600 text-white text-xs uppercase font-bold py-2 rounded border border-blue-400 transition-colors"
    },
    "–¢–ê–õ–ê–ù–¢–´"
  ),

  React.createElement(
    'button',
    {
      onClick: () => goToView('inventory'),
      className: "bg-gray-800 hover:bg-gray-700 text-white text-xs uppercase font-bold py-2 rounded border border-gray-500 transition-colors"
    },
    "–ò–ù–í–ï–ù–¢–ê–†–¨"
  ),

  // 3 —Ä—è–¥: Telegram | Roadmap
  React.createElement(
    'button',
    {
      onClick: () => goToView('telegram_hub'),
      className: "bg-blue-600 hover:bg-blue-500 text-white text-xs uppercase font-bold py-2 rounded border border-blue-400 transition-colors"
    },
    "TELEGRAM"
  ),

  React.createElement(
    'button',
    {
      onClick: () => goToView('roadmap'),
      className: "bg-gray-900 hover:bg-gray-800 text-white text-xs uppercase font-bold py-2 rounded border border-gray-600 transition-colors"
    },
    "ROADMAP"
  ),

  React.createElement(
    'button',
    {
      onClick: () => goToView('oracle'),
      className: "col-span-2 bg-pink-900/50 hover:bg-pink-800 text-pink-200 text-xs uppercase font-bold py-2 rounded border border-pink-700 transition-colors flex items-center justify-center gap-2"
    },
    React.createElement(BrainCircuit, { size: 16 }),
    "–°–ø—Ä–æ—Å–∏—Ç—å –û—Ä–∞–∫—É–ª–∞ (AI)"
  ),
),
    ),

    React.createElement(
      'div',
      { className: "grid grid-cols-1 gap-4" },
      React.createElement(
        'h2',
        { className: "text-xs uppercase tracking-[0.2em] text-gray-500 font-bold ml-1" },
        "–ö–∞—Ä—Ç–∞ –î–µ—Ä–µ–≤–Ω–∏"
      ),
      LOCATIONS.map((loc) => {
        const todayTasks = tasks.filter(t => t.id.includes(loc.id));
        const completedCount = todayTasks.filter(t => t.completed).length;
        const isComplete = todayTasks.length > 0 && completedCount === todayTasks.length;
        const currentVisual =
          (getCurrentUpgrade(loc.id, villageUpgrades[loc.id] || 1) || {}).visual || '‚ùì';

        return React.createElement(
          PixelCard,
          {
            key: loc.id,
            onClick: () => setSelectedLocation(loc),
            className: "group"
          },
          React.createElement(
            'div',
            { className: "flex items-center gap-4" },
            React.createElement(
              'div',
              {
                className:
                  `w-12 h-12 rounded-lg bg-[#0b0f1a] border-2 border-gray-700 flex items-center justify-center group-hover:scale-110 transition-transform duration-300 ${loc.color}`
              },
              React.createElement('span', { className: "text-2xl" }, currentVisual)
            ),
            React.createElement(
              'div',
              { className: "flex-1" },
              React.createElement(
                'div',
                { className: "flex justify-between items-start" },
                React.createElement(
                  'h3',
                  { className: "font-bold text-gray-200" },
                  loc.tvaName
                ),
                isComplete &&
                  React.createElement(
                    'span',
                    { className: "text-emerald-500 text-xs font-bold flex items-center gap-1" },
                    React.createElement(CheckSquare, { size: 12 }),
                    " –ì–û–¢–û–í–û"
                  )
              ),
              React.createElement(
                'p',
                { className: "text-xs text-gray-500 mb-2" },
                loc.name
              ),
              React.createElement(
                'div',
                { className: "h-1.5 bg-gray-800 rounded-full overflow-hidden" },
                React.createElement('div', {
                  className:
                    `h-full transition-all duration-500 ${isComplete ? 'bg-emerald-500' : 'bg-yellow-600'}`,
                  style: {
                    width: `${(completedCount / (todayTasks.length || 1)) * 100}%`
                  }
                })
              )
            ),
            React.createElement(
              ChevronRight,
              { className: "text-gray-700 group-hover:text-yellow-500 transition-colors" }
            )
          )
        );
      })
    )
  ),

  // --- —ç–∫—Ä–∞–Ω –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏ + –∑–∞–¥–∞—á–∏ ---
  selectedLocation && React.createElement(
    'div',
    { className: "space-y-4 animate-in slide-in-from-right-8 duration-300" },

    React.createElement(
      'button',
      {
        onClick: () => setSelectedLocation(null),
        className: "text-xs text-gray-400 hover:text-white flex items-center gap-1 mb-2"
      },
      React.createElement(MapIcon, { size: 12 }),
      " –í–ï–†–ù–£–¢–¨–°–Ø –í –î–ï–†–ï–í–ù–Æ"
    ),

    React.createElement(
      PixelCard,
      { className: "border-yellow-500/30" },
      React.createElement(
        'div',
        { className: "flex items-center gap-4 mb-4" },
        React.createElement(
          'div',
          {
            className:
              `p-3 bg-gray-900 rounded-lg border border-gray-700 ${selectedLocation.color}`
          },
          React.createElement(selectedLocation.icon, { size: 32 })
        ),
        React.createElement(
          'div',
          null,
          React.createElement(
            'h2',
            { className: "text-xl font-bold text-white" },
            selectedLocation.tvaName
          ),
          React.createElement(
            'p',
            { className: "text-xs text-gray-400" },
            selectedLocation.description
          )
        )
      )
    ),

    React.createElement(
      'div',
      { className: "space-y-3" },
      React.createElement(
        'h3',
        { className: "text-xs uppercase tracking-widest text-gray-500 font-bold ml-1" },
        "–ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è"
      ),
      tasks
        .filter(t => t.id.includes(selectedLocation.id) || t.id.includes('bonus'))
        .map(task =>
          React.createElement(
            'div',
            {
              key: task.id,
              className:
                `relative p-4 rounded-lg border-2 transition-all duration-300 ${
                  task.completed
                    ? 'bg-emerald-900/10 border-emerald-900/30 opacity-70'
                    : 'bg-[#151a25] border-[#2a3441] hover:border-gray-500'
                }`
            },

            // –≤–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫
            React.createElement(
              'div',
              { className: "flex justify-between items-start" },

              React.createElement(
                'div',
                { className: "flex-1" },
                React.createElement(
                  'h4',
                  {
                    className:
                      `font-bold text-sm ${
                        task.completed ? 'text-gray-400 line-through' : 'text-gray-200'
                      }`
                  },
                  task.title
                ),
                React.createElement(
                  'p',
                  { className: "text-xs text-gray-500 mt-1" },
                  task.description
                ),
                React.createElement(
                  'div',
                  { className: "flex items-center gap-2 mt-2" },
                  React.createElement(
                    'span',
                    {
                      className:
                        "inline-block text-[10px] font-bold text-yellow-600 bg-yellow-900/20 px-1.5 py-0.5 rounded border border-yellow-900/30"
                    },
                    `+${task.exp} EXP`
                  ),
                  React.createElement(
                    'span',
                    {
                      className:
                        "inline-block text-[10px] font-bold text-yellow-600 bg-yellow-900/20 px-1.5 py-0.5 rounded border border-yellow-900/30"
                    },
                    `+${task.exp * 2} ü™ô`
                  )
                )
              ),

              React.createElement(
                'button',
                {
                  onClick: () => handleCompleteTask(task.id),
                  disabled: task.completed,
                  className:
                    `w-10 h-10 rounded flex items-center justify-center border-b-4 transition-all ` +
                    (task.completed
                      ? 'bg-emerald-600 border-emerald-800 text-white cursor-default translate-y-1 border-b-0'
                      : 'bg-gray-700 border-gray-900 text-gray-400 hover:bg-yellow-600 hover:border-yellow-800 hover:text-white active:translate-y-1 active:border-b-0')
                },
                task.completed
                  ? React.createElement(CheckSquare, { size: 20 })
                  : React.createElement('div', {
                      className: "w-4 h-4 border-2 border-current rounded-sm"
                    })
              )
            ),

            // –Ω–∏–∂–Ω–∏–π –±–ª–æ–∫: –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            task.completed &&
              React.createElement(
                'div',
                { className: "mt-3" },
                React.createElement(
                  'label',
                  {
                    className:
                      "block text-[10px] uppercase text-gray-500 font-bold mb-1"
                  },
                  "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (—á—Ç–æ —Å–¥–µ–ª–∞–ª?)"
                ),
                React.createElement('textarea', {
                  className:
                    "w-full bg-gray-900 border border-gray-700 text-xs text-gray-200 p-2 rounded resize-y focus:border-yellow-500 outline-none",
                  rows: 2,
                  placeholder:
                    "–ù–∞–ø—Ä–∏–º–µ—Ä: —Ä–∞–∑–æ–±—Ä–∞–ª BTC, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª –æ—à–∏–±–∫—É –≤–æ –≤—Ö–æ–¥–µ...",
                  value: task.comment || '',
                  onChange: (e) => handleUpdateTaskComment(task.id, e.target.value)
                })
              )
          )
        )
    )
  ),

  // === –ü–ê–ú–Ø–¢–ö–ê –ü–†–û–ô–¢–ò –¢–ï–°–¢ ¬´–ö–û–õ–ï–°–û –ë–ê–õ–ê–ù–°–ê¬ª ===
  profile && showBalanceTestPrompt && !profile.balanceTestCompleted && view === 'village' &&
    React.createElement(
      'div',
      { className: "fixed inset-0 z-40 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4" },
      React.createElement(
        'div',
        { className: "bg-[#111827] border border-yellow-500/50 rounded-xl p-6 max-w-sm w-full shadow-2xl" },
        React.createElement(
          'h2',
          { className: "text-lg font-bold text-yellow-400 mb-2" },
          '–ü—Ä–æ–π–¥–∏ —Ç–µ—Å—Ç ¬´–ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞¬ª'
        ),
        React.createElement(
          'p',
          { className: "text-xs text-gray-300 mb-4" },
          '–ß—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ –∏ –ø–æ–Ω—è—Ç—å, –≤ –∫–∞–∫–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Ä–∞—Å—Ç–∏ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å ‚Äî ',
          '–ø—Ä–æ–π–¥–∏ –Ω–µ–±–æ–ª—å—à–æ–π —Ç–µ—Å—Ç –ø–æ –ö–æ–ª–µ—Å—É –ë–∞–ª–∞–Ω—Å–∞. –ü–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ç—ã –ø–æ–ª—É—á–∏—à—å –ø–æ–¥—Å–∫–∞–∑–∫–∏, ',
          '–∫–∞–∫–∏–µ —Å—Ñ–µ—Ä—ã —É—Å–∏–ª–∏—Ç—å, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏–π—Ç–∏ –∫ —É—Å–ø–µ—Ö—É.'
        ),
        React.createElement(
          'div',
          { className: "space-y-2" },
          React.createElement(
            'button',
            {
              onClick: () => {
                setShowBalanceTestPrompt(false);
                goToView('balance_test');
              },
              className: "w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold text-xs uppercase py-2 rounded transition-colors"
            },
            '–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç —Å–µ–π—á–∞—Å'
          ),
          React.createElement(
            'button',
            {
              onClick: () => setShowBalanceTestPrompt(false),
              className: "w-full bg-gray-800 hover:bg-gray-700 text-gray-300 text-xs uppercase py-2 rounded transition-colors"
            },
            '–ù–∞–ø–æ–º–Ω–∏—Ç—å –ø–æ–∑–∂–µ'
          )
        )
      )
    ),

  
  // --- –æ—Å—Ç–∞–ª—å–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã ---
  profile && view === 'shop' && React.createElement(ShopView, {
  upgrades: villageUpgrades,
  onUpgrade: handleUpgrade,
  currentGold: player.gold,
  buildingTaskSlots: player.buildingTaskSlots || 0,
  subscriptionTier: player.subscriptionTier,
  onBuyBuilding: handleBuyBuilding,
  onBack: () => goToView('village')
}),

profile && view === 'telegram_hub' && React.createElement(TelegramHubView, {
  onBack: () => goToView('village')
}),

// === –•–∏–∂–∏–Ω–∞ –û—Ä–∞–∫—É–ª–∞ (AI Mentor) ===
profile && view === 'oracle' && React.createElement(OracleView, {
  player: player,
  stats: stats,
  profile: profile,
  onBack: () => goToView('village')
}),

profile && view === 'balance_test' && React.createElement(BalanceTestView, {
  profile: profile,
  onComplete: (scores) => {
    setProfile(prev => prev ? { ...prev, balanceTestCompleted: true, balanceScores: scores } : prev);
    setShowBalanceTestPrompt(false);
    goToView('balance_results');
  },
  onBack: () => {
    setShowBalanceTestPrompt(false);
    goToView('village');
  }
}),

profile && view === 'balance_results' && React.createElement(BalanceResultsView, {
  profile: profile,
  onBack: () => goToView('village')
}),

  profile && view === 'inventory' && React.createElement(InventoryView, {
    artifacts: artifacts,
    equippedIds: player.equippedArtifactIds,
    maxEquipSlots: calculateMaxEquipSlots(player),
    onToggleEquip: handleToggleEquip,
    onBack: () => goToView('village')
  }),

  profile && view === 'talents' && React.createElement(TalentTreeView, {
    talentsData: TALENTS_DATA,
    unlockedTalents: player.unlockedTalents,
    currentGold: player.gold,
    onUnlock: handleUnlockTalent,
    onBack: () => goToView('village')
  }),

  profile && view === 'stats' && React.createElement(StatsView, {
  stats: stats,
  profile: profile,
  subscriptionTier: player.subscriptionTier,
  hasPremiumPass: player.hasPremiumPass,
  onBack: () => goToView('village')
}),

  profile && view === 'profile_edit' && React.createElement(ProfileEditView, {
  profile: profile,
  playerGold: player.gold,
  onSave: handleSaveProfileSettings,
  onBack: () => goToView('village')
}),

  profile && view === 'roadmap' && React.createElement(RoadmapView, {
    onBack: () => goToView('village')
  }),
  profile && view === 'premium' && React.createElement(PremiumView, {
  onBack: () => goToView('village'),
  hasPremiumPass: player.hasPremiumPass,
  subscriptionTier: player.subscriptionTier,
  onActivatePremium: handleActivatePremium,
  onSetSubscriptionTier: handleSetSubscriptionTier,
}),

  React.createElement(MotivationFooter, { viewKey })
),

            showLevelUp && React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-300" },
              React.createElement('div', { className: "bg-[#1a202c] border-4 border-yellow-500 rounded-lg p-8 max-w-sm w-full text-center shadow-[0_0_50px_rgba(234,179,8,0.3)] relative overflow-hidden" },
                 React.createElement('div', { className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-yellow-400 to-transparent opacity-50" }),
                 React.createElement(Trophy, { size: 64, className: "mx-auto text-yellow-500 mb-4 animate-bounce" }),
                 React.createElement('h2', { className: "text-3xl font-bold text-white mb-2 font-mono" }, "–ù–û–í–´–ô –£–†–û–í–ï–ù–¨!"),
                 React.createElement('p', { className: "text-yellow-500 font-bold text-xl mb-6" }, `–£–†–û–í–ï–ù–¨ ${player.level}`),
                 
                 lastGainedArtifact && React.createElement('div', { className: "bg-gray-800 p-4 rounded mb-6 text-sm border-l-4 border-blue-500 text-left" },
                    React.createElement('p', { className: "font-bold text-blue-400 flex items-center gap-2 mb-1" },
                        React.createElement(Zap, { size: 16 }), " –ù–∞–π–¥–µ–Ω–∞ –ù–∞–≥—Ä–∞–¥–∞:"
                    ),
                    React.createElement('p', { className: "text-2xl" }, `${lastGainedArtifact.visual} ${lastGainedArtifact.name}`),
                    React.createElement('p', { className: "text-xs text-gray-400 mt-1" }, lastGainedArtifact.description)
                 ),

                 React.createElement(Button, { variant: "accent", onClick: () => setShowLevelUp(false), className: "w-full" }, "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ü—É—Ç—å")
              )
            ),

            showChallengeComplete && weeklyChallenge && React.createElement(
              'div',
              {
                className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-300"
              },
              React.createElement(
                'div',
                {
                  className: `bg-[#1a202c] border-4 ${
                    weeklyChallenge.isClaimed ? 'border-emerald-500' : 'border-red-500'
                  } rounded-lg p-8 max-w-sm w-full text-center shadow-[0_0_50px_rgba(239,68,68,0.3)] relative overflow-hidden`
                },
                React.createElement('div', {
                  className: "absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-red-400 to-transparent opacity-50"
                }),

                React.createElement(Calendar, {
                  size: 64,
                  className: "mx-auto text-red-500 mb-4 animate-pulse"
                }),
                React.createElement(
                  'h2',
                  { className: "text-3xl font-bold text-white mb-2 font-mono" },
                  weeklyChallenge.isCompleted ? "–ò–°–ü–´–¢–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!" : "–ï–ñ–ï–ù–ï–î–ï–õ–¨–ù–´–ô –ë–û–°–°"
                ),
                React.createElement(
                  'p',
                  { className: "text-lg font-bold mb-4" },
                  weeklyChallenge.title
                ),

                React.createElement(
                  'div',
                  { className: "bg-gray-800 p-4 rounded mb-6 text-sm text-left" },
                  React.createElement(
                    'p',
                    { className: "font-bold text-gray-300 mb-2" },
                    `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${weeklyChallenge.currentProgress} / ${weeklyChallenge.requiredCompletions}`
                  ),
                  React.createElement(
                    'div',
                    { className: "h-2 bg-gray-900 rounded-full overflow-hidden" },
                    React.createElement('div', {
                      className: "h-full bg-red-600",
                      style: {
                        width: `${Math.min(
                          100,
                          (weeklyChallenge.currentProgress / weeklyChallenge.requiredCompletions) * 100
                        )}%`
                      }
                    })
                  ),
                  React.createElement(
                    'div',
                    { className: "mt-4 pt-4 border-t border-gray-700" },
                    React.createElement(
                      'p',
                      { className: "text-xs text-gray-500 mb-1" },
                      "–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –ø–æ–±–µ–¥—É:"
                    ),
                    React.createElement(
                      'p',
                      {
                        className: "font-bold text-emerald-400 flex items-center justify-center gap-4"
                      },
                      React.createElement('span', null, `+${weeklyChallenge.expReward} –û–±—â–µ–≥–æ EXP`),
                      React.createElement('span', null, `${weeklyChallenge.goldReward} ü™ô –ó–æ–ª–æ—Ç–∞`)
                    )
                  )
                ),

                weeklyChallenge.isCompleted && !weeklyChallenge.isClaimed &&
                  React.createElement(Button, {
                    variant: "success",
                    onClick: handleClaimChallenge,
                    className: "w-full"
                  }, "–ü–û–õ–£–ß–ò–¢–¨ –ù–ê–ì–†–ê–î–£"),

                weeklyChallenge.isClaimed &&
                  React.createElement(Button, {
                    variant: "secondary",
                    disabled: true,
                    className: "w-full"
                  }, "–ù–ê–ì–†–ê–î–ê –ü–û–õ–£–ß–ï–ù–ê!"),

                !weeklyChallenge.isCompleted &&
                  React.createElement(Button, {
                    variant: "secondary",
                    onClick: () => setShowChallengeComplete(false),
                    className: "w-full"
                  }, "–û–ö")
              )
            ),   // ‚Üê –í–ê–ñ–ù–û: –∑–∞–ø—è—Ç–∞—è —Ç—É—Ç –æ—Å—Ç–∞—ë—Ç—Å—è ‚Äî —ç—Ç–æ –µ—â—ë –æ–¥–∏–Ω —Ä–µ–±—ë–Ω–æ–∫ div-–∞

            // === Message Toast ===
            message && React.createElement(
              'div',
              {
                className: "fixed bottom-4 right-4 z-50 animate-in slide-in-from-right-8 duration-300",
                onClick: () => setMessage(null)
              },
              React.createElement(
                'div',
                {
                  className:
                    `p-4 rounded-lg shadow-xl max-w-xs cursor-pointer ` +
                    (message.type === 'success'
                      ? 'bg-emerald-600 border-emerald-400'
                      : 'bg-red-600 border-red-400') +
                    ' text-white border-b-4 flex items-center justify-between gap-4'
                },
                React.createElement(
                  'p',
                  { className: "font-bold text-sm" },
                  message.text
                ),
                React.createElement(
                  'button',
                  { className: "text-white hover:opacity-75" },
                  React.createElement(X, { size: 16 })
                )
              )
            )
            )  // ‚Üê —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ (–±–µ–∑ —Ç–æ—á–∫–∏ —Å –∑–∞–ø—è—Ç–æ–π)

        } // ‚Üê –∑–∞–∫—Ä—ã–≤–∞–µ–º function App

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
  </body>
</html>
